<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case #5: Metropolitan Urban Planning Map - Geographic Detective Academy</title>
    <!-- Fictional City Simulation - No external mapping dependencies -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #f39c12;
            --urban-blue: #3498db;
            --danger-color: #e74c3c;
            --success-color: #27ae60;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: rgba(52,152,219,0.9);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .back-btn:hover {
            background: rgba(52,152,219,1);
            transform: translateY(-2px);
        }
        
        .detective-header {
            background: linear-gradient(135deg, var(--urban-blue) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 30px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .case-title {
            font-family: 'Orbitron', monospace;
            font-size: 2.5rem;
            font-weight: 900;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 10px;
        }
        
        .case-subtitle {
            font-size: 1.3rem;
            margin-bottom: 20px;
            opacity: 0.9;
        }
        
        .mission-brief {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            line-height: 1.6;
            backdrop-filter: blur(10px);
        }
        
        #urbanMap {
            height: 75vh;
            width: 100%;
            border: 3px solid var(--urban-blue);
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
            margin: 20px auto;
        }
        
        .map-container {
            padding: 20px;
            background: white;
            margin: 0;
            border-radius: 0 0 15px 15px;
        }
        
        .map-controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            padding: 15px;
            background: rgba(255,255,255,0.9);
            border-bottom: 2px solid var(--urban-blue);
        }
        
        .control-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .detective-btn {
            background: linear-gradient(135deg, var(--urban-blue) 0%, var(--secondary-color) 100%);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 20px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .detective-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52,152,219,0.4);
        }
        
        .detective-btn.active {
            background: linear-gradient(135deg, var(--accent-color) 0%, #e67e22 100%);
            color: #333;
        }
        
        .evidence-counter {
            background: var(--danger-color);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 0.9rem;
        }
        
        .fictional-city-notice {
            position: absolute !important;
            bottom: 10px !important;
            left: 10px !important;
            z-index: 1000 !important;
            background: rgba(44,62,80,0.95) !important;
            color: white !important;
            padding: 12px !important;
            border-radius: 8px !important;
            font-size: 12px !important;
            max-width: 280px !important;
            backdrop-filter: blur(10px) !important;
            border: 1px solid rgba(255,255,255,0.2) !important;
        }
        
        /* Custom fictional city background */
        .fictional-city-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, #87CEEB 0%, #98FB98 30%, #F0E68C 60%, #DEB887 100%);
            z-index: 1;
        }
        
        /* City infrastructure overlay */
        .city-infrastructure {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
        }
        
        /* Roads and streets */
        .main-road {
            position: absolute;
            background: #444444;
            z-index: 3;
        }
        
        .main-road.horizontal {
            height: 6px;
            width: 100%;
            box-shadow: inset 0 0 0 1px #666666;
        }
        
        .main-road.vertical {
            width: 6px;
            height: 100%;
            box-shadow: inset 0 0 0 1px #666666;
        }
        
        .street {
            position: absolute;
            background: #666666;
            z-index: 3;
        }
        
        .street.horizontal {
            height: 3px;
            box-shadow: inset 0 0 0 1px #888888;
        }
        
        .street.vertical {
            width: 3px;
            box-shadow: inset 0 0 0 1px #888888;
        }
        
        /* River */
        .river {
            position: absolute;
            background: linear-gradient(90deg, #4682B4 0%, #87CEEB 50%, #4682B4 100%);
            border-radius: 20px;
            z-index: 2;
            box-shadow: 0 2px 8px rgba(70, 130, 180, 0.3);
        }
        
        /* Buildings and landmarks */
        .building {
            position: absolute;
            background: #8B8B8B;
            border: 1px solid #696969;
            z-index: 4;
            border-radius: 2px;
        }
        
        .building.tower {
            background: linear-gradient(to top, #2F4F4F 0%, #708090 100%);
            box-shadow: 2px 2px 8px rgba(0,0,0,0.3);
        }
        
        .building.commercial {
            background: linear-gradient(to top, #8B4513 0%, #CD853F 100%);
        }
        
        .building.residential {
            background: linear-gradient(to top, #556B2F 0%, #9ACD32 100%);
        }
        
        .building.industrial {
            background: linear-gradient(to top, #2F2F2F 0%, #696969 100%);
        }
        
        /* Parks and green spaces */
        .park {
            position: absolute;
            background: radial-gradient(circle, #228B22 0%, #32CD32 50%, #90EE90 100%);
            border-radius: 10px;
            z-index: 3;
            border: 2px solid #006400;
        }
        
        .park.removed {
            background: radial-gradient(circle, #8B4513 0%, #D2691E 50%, #F4A460 100%);
            border: 2px solid #A0522D;
        }
        
        /* Water features */
        .water {
            position: absolute;
            background: radial-gradient(circle, #4169E1 0%, #87CEEB 100%);
            border-radius: 50%;
            z-index: 2;
        }
        
        /* Grid overlay for city blocks */
        .city-grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(to right, rgba(0,0,0,0.05) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(0,0,0,0.05) 1px, transparent 1px);
            background-size: 40px 40px;
            z-index: 5;
        }
        
        /* District overlay elements */
        .district-overlay {
            position: absolute;
            border: 2px solid;
            border-radius: 8px;
            backdrop-filter: blur(2px);
            z-index: 10;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .district-overlay:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .district-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255,255,255,0.9);
            padding: 8px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            text-align: center;
            pointer-events: none;
            white-space: nowrap;
        }
        
        @media print {
            .detective-header, .map-controls, .back-btn { display: none; }
            #urbanMap { height: 100vh; border: none; }
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="window.history.back()">‚Üê Back to Maps Central</button>
    
    <div class="detective-header">
        <h1 class="case-title">üèôÔ∏è CASE #5: MYSTERY IN THE METROPOLIS</h1>
        <p class="case-subtitle">Urban Planning Investigation - Vanishing Green Spaces</p>
        <div class="mission-brief">
            <strong>MISSION:</strong> The growing city of Urbanopolis (population 2 million) has experienced rapid development over the past 5 years. 
            Community groups report that green spaces - parks, community gardens, and natural areas - are mysteriously disappearing despite 
            the city's official plan calling for a 20% increase in green space. Investigate the development patterns and identify who is 
            responsible for the vanishing green spaces.
        </div>
    </div>
    
    <div class="map-controls">
        <div class="control-group">
            <span class="evidence-counter" id="evidence-count">Evidence Found: 0/8</span>
        </div>
        <div class="control-group">
            <button class="detective-btn" onclick="toggleLayer('zoning')" id="zoning-btn">üèóÔ∏è Zoning Districts</button>
            <button class="detective-btn" onclick="toggleLayer('transportation')" id="transport-btn">üöá Transportation</button>
            <button class="detective-btn" onclick="toggleLayer('green_spaces')" id="green-btn">üå≥ Green Spaces</button>
        </div>
        <div class="control-group">
            <button class="detective-btn" onclick="toggleLayer('development')" id="dev-btn">üìà Development Projects</button>
            <button class="detective-btn" onclick="toggleLayer('population')" id="pop-btn">üèòÔ∏è Population</button>
            <button class="detective-btn" onclick="toggleLayer('evidence')" id="evidence-btn">üîç Evidence</button>
        </div>
        <div class="control-group">
            <button class="detective-btn" onclick="resetInvestigation()">üîÑ Reset Investigation</button>
            <button class="detective-btn" onclick="printMap()">üñ®Ô∏è Print Map</button>
        </div>
    </div>
    
    <div class="map-container">
        <div id="urbanMap">
            <!-- Fictional city background -->
            <div class="fictional-city-canvas">
                <!-- City infrastructure -->
                <div class="city-infrastructure">
                    <!-- River -->
                    <div class="river" style="left: 20px; top: 80px; width: 200px; height: 40px; transform: rotate(-10deg);"></div>
                    
                    <!-- Main roads -->
                    <div class="main-road horizontal" style="top: 200px;"></div>
                    <div class="main-road horizontal" style="top: 350px;"></div>
                    <div class="main-road vertical" style="left: 180px;"></div>
                    <div class="main-road vertical" style="left: 380px;"></div>
                    
                    <!-- Streets -->
                    <div class="street horizontal" style="top: 120px; left: 200px; width: 400px;"></div>
                    <div class="street horizontal" style="top: 280px; left: 100px; width: 500px;"></div>
                    <div class="street horizontal" style="top: 420px; left: 150px; width: 350px;"></div>
                    <div class="street vertical" style="left: 280px; top: 50px; height: 400px;"></div>
                    <div class="street vertical" style="left: 480px; top: 100px; height: 350px;"></div>
                    
                    <!-- Downtown buildings -->
                    <div class="building tower" style="left: 190px; top: 140px; width: 25px; height: 50px;"></div>
                    <div class="building tower" style="left: 220px; top: 130px; width: 30px; height: 60px;"></div>
                    <div class="building tower" style="left: 255px; top: 135px; width: 35px; height: 55px;"></div>
                    <div class="building tower" style="left: 295px; top: 125px; width: 40px; height: 65px;"></div>
                    
                    <!-- Commercial buildings -->
                    <div class="building commercial" style="left: 160px; top: 360px; width: 80px; height: 30px;"></div>
                    <div class="building commercial" style="left: 250px; top: 355px; width: 100px; height: 35px;"></div>
                    <div class="building commercial" style="left: 360px; top: 365px; width: 70px; height: 25px;"></div>
                    
                    <!-- Residential areas -->
                    <div class="building residential" style="left: 410px; top: 60px; width: 60px; height: 40px;"></div>
                    <div class="building residential" style="left: 480px; top: 70px; width: 80px; height: 35px;"></div>
                    <div class="building residential" style="left: 420px; top: 110px; width: 70px; height: 30px;"></div>
                    <div class="building residential" style="left: 500px; top: 115px; width: 65px; height: 32px;"></div>
                    
                    <!-- West end suburbs -->
                    <div class="building residential" style="left: 90px; top: 260px; width: 50px; height: 20px;"></div>
                    <div class="building residential" style="left: 150px; top: 270px; width: 45px; height: 18px;"></div>
                    <div class="building residential" style="left: 200px; top: 250px; width: 55px; height: 22px;"></div>
                    <div class="building residential" style="left: 120px; top: 310px; width: 60px; height: 25px;"></div>
                    
                    <!-- Industrial zone -->
                    <div class="building industrial" style="left: 360px; top: 310px; width: 90px; height: 40px;"></div>
                    <div class="building industrial" style="left: 460px; top: 320px; width: 80px; height: 35px;"></div>
                    <div class="building industrial" style="left: 380px; top: 360px; width: 70px; height: 45px;"></div>
                    <div class="building industrial" style="left: 460px; top: 365px; width: 85px; height: 40px;"></div>
                    
                    <!-- Parks (existing) -->
                    <div class="park" style="left: 450px; top: 340px; width: 60px; height: 40px;" title="City Park - Protected"></div>
                    <div class="park" style="left: 25px; top: 140px; width: 40px; height: 30px;" title="Waterfront Trail - Existing"></div>
                    
                    <!-- Parks (removed - now buildings/construction) -->
                    <div class="park removed" style="left: 235px; top: 160px; width: 50px; height: 35px;" title="Central Park - REMOVED 2022 for Metropolis Tower"></div>
                    <div class="park removed" style="left: 85px; top: 120px; width: 45px; height: 30px;" title="Riverside Gardens - REMOVED 2023 for Luxury Condos"></div>
                    <div class="park removed" style="left: 415px; top: 175px; width: 35px; height: 25px;" title="Heritage Square - REMOVED 2024 for Office Complex"></div>
                    
                    <!-- Water features -->
                    <div class="water" style="left: 30px; top: 160px; width: 20px; height: 20px;" title="River Point"></div>
                    <div class="water" style="left: 45px; top: 190px; width: 15px; height: 15px;" title="Pond"></div>
                </div>
                
                <!-- City grid overlay -->
                <div class="city-grid"></div>
                
                <!-- Fictional city notice -->
                <div class="fictional-city-notice">
                    <strong>üèôÔ∏è FICTIONAL CITY SIMULATION</strong><br>
                    <strong>Urbanopolis</strong> - Educational Investigation<br>
                    <em>Population: 2 million residents</em><br>
                    <small>Geographic features simulated for learning</small>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Fictional city investigation system
        let activeLayer = null;
        let evidenceFound = 0;
        const totalEvidence = 8;
        let discoveredEvidence = new Set();
        
        // Fictional Urbanopolis districts and features
        const cityDistricts = {
            downtown: {
                name: "Downtown Core",
                x: 200, y: 150, width: 150, height: 100,
                color: "#9b59b6",
                type: "Commercial High-Rise",
                description: "Major business district with 47-story towers. Originally had Central Park (12 acres) - REMOVED 2022 for Metropolis Tower development.",
                green_status: "MAJOR DEFICIT - Lost 12 acres, no replacement"
            },
            riverside: {
                name: "Riverside Mixed-Use",
                x: 50, y: 100, width: 120, height: 80,
                color: "#3498db", 
                type: "Mixed-Use Development",
                description: "Waterfront development zone. Lost Riverside Community Gardens (8 acres) in 2023.",
                green_status: "SIGNIFICANT LOSS - Gardens replaced by condos"
            },
            northside: {
                name: "Northside Residential",
                x: 400, y: 50, width: 180, height: 120,
                color: "#2ecc71",
                type: "High-Density Residential", 
                description: "Growing residential area. Oakwood Nature Preserve (15 acres) under threat.",
                green_status: "THREATENED - Preserve zoned for development"
            },
            westend: {
                name: "West End Suburbs",
                x: 80, y: 250, width: 200, height: 90,
                color: "#95a5a6",
                type: "Low-Density Residential",
                description: "Established suburban neighborhoods. Maintains some green space.",
                green_status: "STABLE - Meeting minimum requirements"
            },
            industrial: {
                name: "Industrial Zone",
                x: 350, y: 300, width: 160, height: 110,
                color: "#e67e22",
                type: "Heavy Industrial",
                description: "Manufacturing and logistics hub. No green space requirements.",
                green_status: "EXEMPT - Industrial zoning"
            },
            commercial: {
                name: "Commercial Strip",
                x: 150, y: 350, width: 170, height: 70,
                color: "#f39c12",
                type: "Commercial Strip Development",
                description: "Shopping centers and services. Minimal green space compliance.",
                green_status: "BELOW STANDARD - 3% vs 15% required"
            }
        };
        
        const greenSpaces = {
            disappeared: [
                {name: "Central Park", x: 240, y: 170, status: "REMOVED 2022", acres: 12, threat: "Metropolis Tower"},
                {name: "Riverside Gardens", x: 90, y: 130, status: "REMOVED 2023", acres: 8, threat: "Luxury Condos"},
                {name: "Heritage Square", x: 420, y: 180, status: "REMOVED 2024", acres: 5, threat: "Office Complex"}
            ],
            threatened: [
                {name: "Oakwood Preserve", x: 480, y: 100, status: "UNDER THREAT", acres: 15, threat: "Proposed Mall"},
                {name: "Maple Grove", x: 180, y: 280, status: "PENDING REMOVAL", acres: 6, threat: "Parking Structure"}
            ],
            existing: [
                {name: "City Park", x: 450, y: 350, status: "PROTECTED", acres: 10, threat: "None"},
                {name: "Waterfront Trail", x: 30, y: 150, status: "EXISTING", acres: 4, threat: "Monitoring"}
            ]
        };
        
        const evidenceLocations = [
            {id: "E001", x: 250, y: 180, type: "Financial Records", description: "Metropolis Corp donation to Mayor's campaign"},
            {id: "E002", x: 100, y: 140, type: "Zoning Documents", description: "Emergency zoning change for Riverside project"},
            {id: "E003", x: 430, y: 190, type: "Email Communications", description: "Planning Director private meetings with developers"},
            {id: "E004", x: 200, y: 300, type: "Construction Permits", description: "Expedited permits bypassing environmental review"},
            {id: "E005", x: 490, y: 110, type: "Public Records", description: "Oakwood Preserve secretly rezoned commercial"},
            {id: "E006", x: 180, y: 290, type: "Financial Transfers", description: "$50K payment to city council member"},
            {id: "E007", x: 280, y: 200, type: "Meeting Minutes", description: "Closed-door sessions on green space policy"},
            {id: "E008", x: 370, y: 250, type: "Contract Documents", description: "No-bid contracts to Metropolis Corp subsidiaries"}
        ];
        
        // Initialize the fictional city visualization
        function initializeFictionalCity() {
            const mapContainer = document.getElementById('urbanMap');
            mapContainer.style.position = 'relative';
            mapContainer.style.overflow = 'hidden';
            
            // Add districts
            Object.keys(cityDistricts).forEach(key => {
                const district = cityDistricts[key];
                createDistrict(district, key);
            });
            
            // Add green spaces
            addGreenSpaces();
            
            // Add evidence markers
            addEvidenceMarkers();
            
            console.log('üèôÔ∏è Fictional Urbanopolis City Initialized');
            console.log('üîç Case #5: Metropolitan Urban Planning Investigation Ready');
            console.log('üå≥ Mission: Investigate vanishing green spaces corruption');
        }
        
        function createDistrict(district, id) {
            const districtDiv = document.createElement('div');
            districtDiv.className = 'district-overlay';
            districtDiv.id = `district-${id}`;
            districtDiv.style.left = district.x + 'px';
            districtDiv.style.top = district.y + 'px';
            districtDiv.style.width = district.width + 'px';
            districtDiv.style.height = district.height + 'px';
            districtDiv.style.borderColor = district.color;
            districtDiv.style.backgroundColor = district.color + '20';
            districtDiv.style.display = 'none'; // Hidden by default
            
            const label = document.createElement('div');
            label.className = 'district-label';
            label.textContent = district.name;
            label.style.backgroundColor = district.color + 'CC';
            label.style.color = 'white';
            districtDiv.appendChild(label);
            
            districtDiv.onclick = () => showDistrictInfo(district);
            
            document.getElementById('urbanMap').appendChild(districtDiv);
        }
        
        function addGreenSpaces() {
            ['disappeared', 'threatened', 'existing'].forEach(category => {
                greenSpaces[category].forEach(space => {
                    const spaceDiv = document.createElement('div');
                    spaceDiv.className = `green-space ${category}`;
                    spaceDiv.style.position = 'absolute';
                    spaceDiv.style.left = space.x + 'px';
                    spaceDiv.style.top = space.y + 'px';
                    spaceDiv.style.width = '30px';
                    spaceDiv.style.height = '30px';
                    spaceDiv.style.borderRadius = '50%';
                    spaceDiv.style.display = 'none';
                    spaceDiv.style.cursor = 'pointer';
                    spaceDiv.style.zIndex = '100';
                    spaceDiv.style.border = '3px solid white';
                    spaceDiv.style.display = 'flex';
                    spaceDiv.style.alignItems = 'center';
                    spaceDiv.style.justifyContent = 'center';
                    spaceDiv.style.fontWeight = 'bold';
                    
                    if (category === 'disappeared') {
                        spaceDiv.style.backgroundColor = '#e74c3c';
                        spaceDiv.innerHTML = '‚ùå';
                        spaceDiv.title = `${space.name} - REMOVED ${space.status.split(' ')[1]} (${space.acres} acres)`;
                    } else if (category === 'threatened') {
                        spaceDiv.style.backgroundColor = '#f39c12';
                        spaceDiv.innerHTML = '‚ö†Ô∏è';
                        spaceDiv.title = `${space.name} - ${space.status} (${space.acres} acres)`;
                    } else {
                        spaceDiv.style.backgroundColor = '#27ae60';
                        spaceDiv.innerHTML = 'üå≥';
                        spaceDiv.title = `${space.name} - ${space.status} (${space.acres} acres)`;
                    }
                    
                    spaceDiv.onclick = () => showGreenSpaceInfo(space);
                    
                    document.getElementById('urbanMap').appendChild(spaceDiv);
                });
            });
        }
        
        function addEvidenceMarkers() {
            evidenceLocations.forEach(evidence => {
                const evidenceDiv = document.createElement('div');
                evidenceDiv.className = 'evidence-marker';
                evidenceDiv.style.position = 'absolute';
                evidenceDiv.style.left = evidence.x + 'px';
                evidenceDiv.style.top = evidence.y + 'px';
                evidenceDiv.style.width = '35px';
                evidenceDiv.style.height = '35px';
                evidenceDiv.style.borderRadius = '50%';
                evidenceDiv.style.backgroundColor = '#e74c3c';
                evidenceDiv.style.color = 'white';
                evidenceDiv.style.display = 'none';
                evidenceDiv.style.cursor = 'pointer';
                evidenceDiv.style.zIndex = '200';
                evidenceDiv.style.border = '3px solid white';
                evidenceDiv.style.fontSize = '16px';
                evidenceDiv.style.display = 'flex';
                evidenceDiv.style.alignItems = 'center';
                evidenceDiv.style.justifyContent = 'center';
                evidenceDiv.style.fontWeight = 'bold';
                evidenceDiv.innerHTML = 'üîç';
                evidenceDiv.title = `Evidence ${evidence.id}: ${evidence.type}`;
                
                evidenceDiv.onclick = () => discoverEvidence(evidence);
                
                document.getElementById('urbanMap').appendChild(evidenceDiv);
            });
        }
        
        function toggleLayer(layerType) {
            const btn = document.getElementById(layerType === 'zoning' ? 'zoning-btn' : 
                                               layerType === 'transportation' ? 'transport-btn' :
                                               layerType === 'green_spaces' ? 'green-btn' :
                                               layerType === 'development' ? 'dev-btn' :
                                               layerType === 'population' ? 'pop-btn' : 'evidence-btn');
            
            // Toggle button state
            if (btn.classList.contains('active')) {
                btn.classList.remove('active');
                hideLayer(layerType);
            } else {
                // Remove active state from other buttons
                document.querySelectorAll('.detective-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                hideAllLayers();
                showLayer(layerType);
            }
        }
        
        function showLayer(layerType) {
            if (layerType === 'zoning') {
                document.querySelectorAll('.district-overlay').forEach(el => el.style.display = 'block');
            } else if (layerType === 'green_spaces') {
                document.querySelectorAll('.green-space').forEach(el => el.style.display = 'flex');
            } else if (layerType === 'evidence') {
                document.querySelectorAll('.evidence-marker').forEach(el => el.style.display = 'flex');
            }
            // Add other layer types as needed
        }
        
        function hideLayer(layerType) {
            if (layerType === 'zoning') {
                document.querySelectorAll('.district-overlay').forEach(el => el.style.display = 'none');
            } else if (layerType === 'green_spaces') {
                document.querySelectorAll('.green-space').forEach(el => el.style.display = 'none');
            } else if (layerType === 'evidence') {
                document.querySelectorAll('.evidence-marker').forEach(el => el.style.display = 'none');
            }
        }
        
        function hideAllLayers() {
            document.querySelectorAll('.district-overlay, .green-space, .evidence-marker').forEach(el => {
                el.style.display = 'none';
            });
        }
        
        function showDistrictInfo(district) {
            alert(`üèóÔ∏è ${district.name}\n\nZoning: ${district.type}\n\nDescription: ${district.description}\n\nGreen Space Status: ${district.green_status}`);
        }
        
        function showGreenSpaceInfo(space) {
            alert(`üå≥ ${space.name}\n\nSize: ${space.acres} acres\nStatus: ${space.status}\nThreat: ${space.threat}\n\n${space.status.includes('REMOVED') ? 'This green space was lost to development - investigate who approved this!' : space.status.includes('THREAT') ? 'This space is at risk - monitor approval processes!' : 'This space is currently protected.'}`);
        }
        
        function discoverEvidence(evidence) {
            if (!discoveredEvidence.has(evidence.id)) {
                discoveredEvidence.add(evidence.id);
                evidenceFound++;
                updateEvidenceCounter();
                
                alert(`üîç EVIDENCE DISCOVERED!\n\nEvidence ${evidence.id}: ${evidence.type}\n\nDescription: ${evidence.description}\n\nProgress: ${evidenceFound}/${totalEvidence} Evidence Items Found\n\n${evidenceFound >= 6 ? 'You are building a strong case against the corruption network!' : 'Keep investigating to uncover the full conspiracy!'}`);
            } else {
                alert(`üîç Evidence ${evidence.id} already discovered.\n\nType: ${evidence.type}\nDescription: ${evidence.description}`);
            }
        }
        
        function updateEvidenceCounter() {
            const counter = document.getElementById('evidence-count');
            counter.textContent = `Evidence Found: ${evidenceFound}/${totalEvidence}`;
            
            if (evidenceFound >= totalEvidence) {
                counter.style.backgroundColor = '#27ae60';
                setTimeout(() => {
                    alert('üéâ INVESTIGATION COMPLETE!\n\nYou have uncovered the coordinated scheme between Metropolis Development Corporation and city officials that is systematically converting green spaces to profitable developments.\n\nKey Findings:\n‚Ä¢ $50,000+ in campaign contributions to city officials\n‚Ä¢ Emergency zoning changes without public review\n‚Ä¢ No-bid contracts to developer subsidiaries\n‚Ä¢ 25 acres of green space lost in 2 years\n\nRecommendation: Turn evidence over to state prosecutor for corruption charges!');
                }, 500);
            } else if (evidenceFound >= 4) {
                counter.style.backgroundColor = '#f39c12';
            }
        }
        
        function resetInvestigation() {
            discoveredEvidence.clear();
            evidenceFound = 0;
            updateEvidenceCounter();
            hideAllLayers();
            document.querySelectorAll('.detective-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('evidence-count').style.backgroundColor = '#e74c3c';
            alert('üîÑ Investigation Reset\n\nAll evidence cleared. Begin your investigation by exploring the different layers to uncover the green space conspiracy!');
        }
        
        function printMap() {
            window.print();
        }
        
        // Initialize the fictional city when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeFictionalCity();
            
            // Auto-show zoning layer as starting point
            setTimeout(() => {
                document.getElementById('zoning-btn').click();
            }, 1000);
            
            // Welcome message
            setTimeout(() => {
                alert('üèôÔ∏è Welcome to Urbanopolis Investigation!\n\nMission: Investigate the mysterious disappearance of green spaces in this growing city.\n\nüîç Investigation Tips:\n‚Ä¢ Click layer buttons to explore different city features\n‚Ä¢ Click on districts and markers to gather information\n‚Ä¢ Look for evidence markers (üîç) to build your case\n‚Ä¢ Find all 8 pieces of evidence to solve the case!\n\nStart by exploring the Zoning Districts to understand the city layout.');
            }, 1500);
        });
    </script>
</body>
</html>
