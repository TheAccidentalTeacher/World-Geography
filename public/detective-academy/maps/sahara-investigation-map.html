<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèúÔ∏è Sahara Desert Investigation Map - Case #2</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
    
    <style>
        :root {
            --primary-color: #ff6b35;
            --secondary-color: #4ecdc4;
            --accent-color: #ffd700;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --sahara-sand: #d4a574;
            --sahara-deep: #b8956a;
            --oasis-blue: #0a74da;
            --desert-orange: #ff6b35;
            --desert-red: #e74c3c;
        }
        
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
        }
        
        body { 
            font-family: 'Roboto', sans-serif; 
            background: linear-gradient(135deg, #d4a574 0%, #b8956a 100%);
            min-height: 100vh;
            color: #333;
            overflow: hidden;
        }
        
        .detective-header {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            padding: 20px;
            text-align: center;
            border-bottom: 4px solid var(--accent-color);
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
        }
        
        .case-title {
            font-family: 'Orbitron', monospace;
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--sahara-deep);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 10px;
        }
        
        .case-subtitle {
            font-size: 1.2rem;
            color: #666;
            font-weight: 500;
        }
        
        .mission-brief {
            background: linear-gradient(135deg, var(--desert-orange), var(--desert-red));
            color: white;
            padding: 15px 25px;
            margin: 15px 0;
            border-radius: 15px;
            font-weight: 500;
            text-align: center;
            box-shadow: 0 4px 15px rgba(255,107,53,0.3);
        }
        
        #saharaMap {
            height: calc(100vh - 140px);
            width: 100%;
            margin-top: 140px;
            border-radius: 0;
            border: none;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.1);
        }
        
        .map-controls {
            position: fixed;
            top: 160px;
            left: 20px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            z-index: 1000;
            max-width: 280px;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-title {
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            color: var(--sahara-deep);
            margin-bottom: 10px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .detective-btn {
            background: linear-gradient(135deg, var(--sahara-sand), var(--sahara-deep));
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 25px;
            font-family: 'Roboto', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }
        
        .detective-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            background: linear-gradient(135deg, var(--desert-orange), var(--desert-red));
        }
        
        .detective-btn.active {
            background: linear-gradient(135deg, var(--success-color), #27ae60);
            box-shadow: 0 0 20px rgba(46,204,113,0.5);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 20px rgba(46,204,113,0.5); }
            50% { box-shadow: 0 0 30px rgba(46,204,113,0.8); }
            100% { box-shadow: 0 0 20px rgba(46,204,113,0.5); }
        }
        
        .evidence-counter {
            background: linear-gradient(135deg, var(--primary-color), var(--danger-color));
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            text-align: center;
            margin: 10px 5px;
            box-shadow: 0 4px 15px rgba(255,107,53,0.3);
            font-size: 1.1em;
        }
        
        .evidence-item {
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--sahara-sand);
        }
        
        .evidence-title {
            font-weight: 700;
            color: var(--sahara-deep);
            margin-bottom: 8px;
        }
        
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            cursor: pointer;
            z-index: 1002;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255,255,255,0.9);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        
        .legend-title {
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--sahara-deep);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid #333;
        }
        
        .investigation-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 380px;
            height: 100vh;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            box-shadow: -5px 0 25px rgba(0,0,0,0.3);
            transition: right 0.4s ease;
            z-index: 1003;
            overflow-y: auto;
        }
        
        .investigation-panel.open {
            right: 0;
        }
        
        .panel-header {
            background: linear-gradient(135deg, var(--sahara-sand), var(--sahara-deep));
            color: white;
            padding: 20px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 1.2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: background 0.3s ease;
        }
        
        .close-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        
        #evidenceLog {
            padding: 20px;
            max-height: calc(100vh - 80px);
            overflow-y: auto;
            font-size: 1.1em;
        }
        
        @media print {
            .detective-header, .map-controls, .investigation-panel, .back-btn { display: none; }
            #saharaMap { height: 100vh; border: none; margin-top: 0; }
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="window.history.back()">‚Üê Back to Maps Central</button>
    
    <div class="detective-header">
        <h1 class="case-title">üèúÔ∏è CASE #2: SAHARA INVESTIGATION</h1>
        <p class="case-subtitle">Navigate the World's Largest Hot Desert to Locate the Missing Caravan</p>
        <div class="mission-brief">
            <strong>MISSION:</strong> Dr. Hassan's archaeological caravan has vanished while studying ancient trade routes. Use this 
            interactive map to track their route through climate zones, oasis locations, and historical pathways across the vast Sahara Desert.
        </div>
    </div>
    
    <div class="map-controls">
        <div class="control-group">
            <div class="control-title">Environmental Layers</div>
            <button class="detective-btn" onclick="toggleLayer('oases')">üíß Oases</button>
            <button class="detective-btn" onclick="toggleLayer('dunes')">üèîÔ∏è Dune Systems</button>
            <button class="detective-btn" onclick="toggleLayer('routes')">üê™ Trade Routes</button>
            <button class="detective-btn" onclick="toggleLayer('evidence')">üîç Evidence</button>
        </div>
        <div class="control-group">
            <button class="detective-btn" onclick="toggleLayer('cities')">üèòÔ∏è Cities</button>
            <button class="detective-btn" onclick="toggleLayer('tribes')">üë• Tribal Areas</button>
            <button class="detective-btn" onclick="toggleLayer('climate')">üå°Ô∏è Climate Zones</button>
        </div>
        <div class="control-group">
            <div class="evidence-counter">Evidence Found: <span id="evidenceCount">0</span>/8</div>
            <button class="detective-btn" onclick="togglePanel()">üìã Investigation Notes</button>
            <button class="detective-btn" onclick="printMap()">üñ®Ô∏è Print Map</button>
        </div>
    </div>
    
    <div id="saharaMap"></div>
    
    <div class="legend">
        <div class="legend-title">Map Legend</div>
        <div class="legend-item">
            <div class="legend-color" style="background: #0a74da;"></div>
            <span>Oases & Water Sources</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #f39c12;"></div>
            <span>Ancient Trade Routes</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #e74c3c;"></div>
            <span>Evidence Locations</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #9b59b6;"></div>
            <span>Last Known Position</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #e67e22;"></div>
            <span>Desert Cities</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #8e44ad;"></div>
            <span>Tribal Territories</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #c0392b;"></div>
            <span>Extreme Climate Zones</span>
        </div>
    </div>
    
    <div class="investigation-panel" id="investigationPanel">
        <div class="panel-header">
            üïµÔ∏è Investigation Log
            <button class="close-btn" onclick="togglePanel()" title="Close Investigation Log">‚úï</button>
        </div>
        <div id="evidenceLog">
            <p style="color: #666; font-style: italic;">Click on evidence markers to record your findings...</p>
        </div>
    </div>
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .case-subtitle {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 15px;
        }
        
        .mission-brief {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px auto;
            max-width: 800px;
            font-weight: 500;
        }
        
        .map-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.9);
            padding: 15px 20px;
            border-bottom: 2px solid var(--sahara-deep);
        }
        
        .control-group {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .detective-btn {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .detective-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        
        .clue-counter {
            background: var(--warning-color);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
        }
        
        #saharaMap {
            height: 70vh;
            width: 100%;
            border: 3px solid var(--sahara-deep);
        }
        
        .investigation-panel {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            height: 100vh;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            padding: 20px;
            box-shadow: -5px 0 20px rgba(0,0,0,0.3);
            transition: right 0.3s ease;
            z-index: 1001;
            overflow-y: auto;
        }
        
        .investigation-panel.open {
            right: 0;
        }
        
        .panel-header {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--sahara-deep);
            margin-bottom: 20px;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
        }
        
        .clue-item {
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--sahara-deep);
        }
        
        .clue-title {
            font-weight: 700;
            color: var(--sahara-deep);
            margin-bottom: 8px;
        }
        
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            cursor: pointer;
            z-index: 1002;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255,255,255,0.9);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        
        .legend-title {
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--sahara-deep);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid #333;
        }
        
        .warning-counter {
            background: var(--danger-color);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
        }
        
        @media print {
            .detective-header, .map-controls, .investigation-panel, .back-btn { display: none; }
            #saharaMap { height: 100vh; border: none; }
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="window.history.back()">‚Üê Back to Maps Central</button>
    
    <div class="detective-header">
        <h1 class="case-title">üèúÔ∏è CASE #2: SAHARA INVESTIGATION</h1>
        <p class="case-subtitle">Navigate the Desert to Find the Lost Caravan</p>
        <div class="mission-brief">
            <strong>MISSION:</strong> A trading caravan has vanished in the Sahara Desert. 
            Use climate zones, oasis locations, and ancient trade routes to track their path and determine their fate.
        </div>
    </div>
    
    <div class="map-controls">
        <div class="control-group">
            <button class="detective-btn" onclick="toggleLayer('climate')">üå°Ô∏è Climate Zones</button>
            <button class="detective-btn" onclick="toggleLayer('oases')">üíß Oases</button>
            <button class="detective-btn" onclick="toggleLayer('routes')">üõ§Ô∏è Trade Routes</button>
            <button class="detective-btn" onclick="toggleLayer('clues')">üîç Clues</button>
        </div>
        <div class="control-group">
            <div class="clue-counter">Clues Found: <span id="clueCount">0</span>/10</div>
            <div class="warning-counter">‚ö†Ô∏è Danger Level: <span id="dangerLevel">Low</span></div>
            <button class="detective-btn" onclick="togglePanel()">üìã Investigation Log</button>
            <button class="detective-btn" onclick="printMap()">üñ®Ô∏è Print Map</button>
        </div>
    </div>
    
    <div id="saharaMap"></div>
    
    <div class="legend">
        <div class="legend-title">Desert Navigation Legend</div>
        <div class="legend-item">
            <div class="legend-color" style="background: #0a74da;"></div>
            <span>Oases & Water Sources</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #f39c12;"></div>
            <span>Ancient Trade Routes</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #e74c3c;"></div>
            <span>Clue Locations</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #27ae60;"></div>
            <span>Hyperarid Zone</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #8e44ad;"></div>
            <span>Last Known Position</span>
        </div>
    </div>
    
    <div class="investigation-panel" id="investigationPanel">
        <div class="panel-header">üèúÔ∏è Desert Investigation Log</div>
        <div id="clueLog">
            <p style="color: #666; font-style: italic;">Navigate the desert and click on clue markers to track the caravan...</p>
        </div>
    </div>
    
    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // Initialize the map centered on Sahara Desert
        const saharaMap = L.map('saharaMap').setView([23.4162, 25.6628], 5);
        
        // Add multiple base layers for different perspectives
        const baseLayers = {
            'Satellite': L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
            }),
            'Terrain': L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
                attribution: 'Map data: &copy; OpenStreetMap contributors, SRTM | Map style: &copy; OpenTopoMap (CC-BY-SA)'
            }),
            'Desert View': L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            })
        };
        
        // Start with satellite view for better desert visualization
        baseLayers['Satellite'].addTo(saharaMap);
        
        // Add layer control
        L.control.layers(baseLayers).addTo(saharaMap);
        
        // Layer groups for different map elements
        const layers = {
            climate: L.layerGroup(),
            oases: L.layerGroup(),
            routes: L.layerGroup(),
            clues: L.layerGroup()
        };
        
        // Clue tracking
        let cluesFound = 0;
        const totalClues = 10;
        let dangerLevel = 'Low';
        
        // Major oases data
        const oasesData = [
            {
                name: "Siwa Oasis",
                coords: [29.2028, 25.5194],
                size: "Large",
                status: "Active Trading Post",
                description: "Major oasis with permanent settlements. Caravan reported restocking here 2 weeks ago."
            },
            {
                name: "Bahariya Oasis",
                coords: [28.3489, 28.8642],
                size: "Medium",
                status: "Recent Activity",
                description: "Local traders confirm caravan passage. Unusual urgency noted in their behavior."
            },
            {
                name: "Farafra Oasis",
                coords: [27.0583, 27.9667],
                size: "Small",
                status: "Abandoned Camp",
                description: "Signs of hasty departure. Some supplies left behind suggest emergency evacuation."
            },
            {
                name: "Dakhla Oasis",
                coords: [25.5000, 29.0000],
                size: "Large",
                status: "Search Base",
                description: "Current rescue operation headquarters. Local guides organizing search parties."
            },
            {
                name: "Kharga Oasis",
                coords: [25.4417, 30.5417],
                size: "Medium",
                status: "Safe Haven",
                description: "Fortified oasis with emergency supplies. No recent caravan activity."
            }
        ];
        
        // Ancient trade routes
        const tradeRoutes = [
            {
                name: "Trans-Saharan Gold Route",
                coords: [[20.0000, 0.0000], [23.4162, 25.6628], [30.0444, 31.2357]],
                color: "#f39c12",
                status: "Historical Primary Route"
            },
            {
                name: "Ivory Coast Passage",
                coords: [[18.0000, -5.0000], [20.0000, 10.0000], [25.0000, 20.0000]],
                color: "#e67e22",
                status: "Secondary Route"
            },
            {
                name: "Salt Caravan Trail",
                coords: [[25.5000, 29.0000], [23.4162, 25.6628], [20.0000, 15.0000]],
                color: "#d35400",
                status: "Missing Caravan's Intended Route"
            }
        ];
        
        // Climate zones for educational understanding
        const climateZones = [
            {
                name: "Hyperarid Core",
                coords: [[20.0000, 15.0000], [25.0000, 35.0000], [30.0000, 25.0000], [25.0000, 5.0000]],
                color: "#e74c3c",
                opacity: 0.3,
                description: "Extreme heat, no rainfall, deadly without preparation"
            },
            {
                name: "Arid Periphery",
                coords: [[15.0000, 10.0000], [30.0000, 40.0000], [35.0000, 30.0000], [20.0000, 0.0000]],
                color: "#f39c12",
                opacity: 0.2,
                description: "Very hot and dry, occasional rainfall"
            }
        ];
        
        // Clue locations with increasing difficulty and educational content
        const clueData = [
            {
                coords: [29.2028, 25.5194],
                title: "Trading Post Records",
                content: "Caravan ledger shows purchase of extra water and emergency supplies. Leader seemed worried about 'unusual weather patterns'.",
                type: "document",
                difficulty: "Easy",
                danger: 1
            },
            {
                coords: [28.3489, 28.8642],
                title: "Guide's Testimony",
                content: "Local guide refused to continue with caravan, citing 'bad omens' and reports of severe sandstorms ahead.",
                type: "witness",
                difficulty: "Easy",
                danger: 1
            },
            {
                coords: [27.0583, 27.9667],
                title: "Abandoned Supplies",
                content: "Half-buried water containers and torn fabric suggest emergency camp. Wind patterns indicate camp was hastily abandoned.",
                type: "physical",
                difficulty: "Medium",
                danger: 2
            },
            {
                coords: [26.2000, 26.0000],
                title: "Camel Tracks",
                content: "Partial tracks leading northwest into unmarked terrain. Pattern suggests animals were under stress.",
                type: "tracking",
                difficulty: "Medium",
                danger: 3
            },
            {
                coords: [25.8000, 24.5000],
                title: "Emergency Signal Fire",
                content: "Remains of signal fire on high dune. Smoke would have been visible for miles. No response recorded.",
                type: "signal",
                difficulty: "Medium",
                danger: 3
            },
            {
                coords: [24.5000, 23.0000],
                title: "Meteorological Data",
                content: "Satellite data shows massive sandstorm passed through this area 5 days ago. Duration: 18 hours, winds: 70+ mph.",
                type: "scientific",
                difficulty: "Hard",
                danger: 4
            },
            {
                coords: [23.8000, 22.2000],
                title: "GPS Device Fragment",
                content: "Damaged GPS unit with partial coordinates recorded. Last position logged in the heart of the hyperarid zone.",
                type: "technology",
                difficulty: "Hard",
                danger: 4
            },
            {
                coords: [23.2000, 21.8000],
                title: "Emergency Shelter",
                content: "Makeshift shelter built from caravan supplies. Shows signs of occupation for 2-3 days before abandonment.",
                type: "physical",
                difficulty: "Hard",
                danger: 5
            },
            {
                coords: [22.8000, 21.2000],
                title: "Rescue Beacon",
                content: "Emergency beacon found buried in sand. Battery died after 4 days of transmission. Final message: 'Water low, seeking shelter'.",
                type: "technology",
                difficulty: "Very Hard",
                danger: 5
            },
            {
                coords: [22.5000, 20.8000],
                title: "Final Camp",
                content: "Caravan's final position discovered. Evidence suggests successful rescue by nomadic tribe. All members safe!",
                type: "resolution",
                difficulty: "Very Hard",
                danger: 1
            }
        ];
        
        // Add climate zones
        function addClimateZones() {
            climateZones.forEach(zone => {
                const polygon = L.polygon(zone.coords, {
                    color: zone.color,
                    fillColor: zone.color,
                    fillOpacity: zone.opacity,
                    weight: 2
                }).addTo(layers.climate);
                
                polygon.bindPopup(`
                    <div style="font-family: 'Roboto', sans-serif;">
                        <h3 style="color: ${zone.color}; margin-bottom: 10px;">${zone.name}</h3>
                        <p>${zone.description}</p>
                        <p style="margin-top: 10px; font-weight: bold; color: #e74c3c;">‚ö†Ô∏è Extreme caution required</p>
                    </div>
                `);
            });
        }
        
        // Add oases
        function addOases() {
            oasesData.forEach(oasis => {
                const oasisIcon = L.divIcon({
                    className: 'oasis-marker',
                    html: `<div style="background: #0a74da; border: 3px solid white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-size: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">üíß</div>`,
                    iconSize: [30, 30],
                    iconAnchor: [15, 15]
                });
                
                const marker = L.marker(oasis.coords, { icon: oasisIcon }).addTo(layers.oases);
                
                marker.bindPopup(`
                    <div style="font-family: 'Roboto', sans-serif; min-width: 200px;">
                        <h3 style="color: #0a74da; margin-bottom: 10px;">${oasis.name}</h3>
                        <p><strong>Size:</strong> ${oasis.size}</p>
                        <p><strong>Status:</strong> <span style="color: ${getStatusColor(oasis.status)}">${oasis.status}</span></p>
                        <p style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;">${oasis.description}</p>
                    </div>
                `);
            });
        }
        
        // Add trade routes
        function addTradeRoutes() {
            tradeRoutes.forEach(route => {
                const routeLine = L.polyline(route.coords, {
                    color: route.color,
                    weight: 4,
                    opacity: 0.8,
                    dashArray: '10, 5'
                }).addTo(layers.routes);
                
                routeLine.bindPopup(`
                    <div style="font-family: 'Roboto', sans-serif;">
                        <h3 style="color: ${route.color}; margin-bottom: 10px;">${route.name}</h3>
                        <p><strong>Status:</strong> ${route.status}</p>
                        <p><strong>Historical Use:</strong> Major trade artery</p>
                        <p><strong>Current Condition:</strong> Navigable with guides</p>
                    </div>
                `);
            });
        }
        
        // Add clues with progressive difficulty
        function addClues() {
            clueData.forEach((clue, index) => {
                const clueIcon = L.divIcon({
                    className: 'clue-marker',
                    html: `<div style="background: #e74c3c; border: 3px solid white; border-radius: 50%; width: 25px; height: 25px; display: flex; align-items: center; justify-content: center; font-size: 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.3); cursor: pointer;">üîç</div>`,
                    iconSize: [25, 25],
                    iconAnchor: [12.5, 12.5]
                });
                
                const marker = L.marker(clue.coords, { icon: clueIcon }).addTo(layers.clues);
                
                marker.on('click', function() {
                    discoverClue(index, clue);
                });
                
                marker.bindPopup(`
                    <div style="font-family: 'Roboto', sans-serif; min-width: 250px;">
                        <h3 style="color: #e74c3c; margin-bottom: 10px;">üîç ${clue.title}</h3>
                        <p style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 10px;">${clue.content}</p>
                        <p><strong>Clue Type:</strong> ${clue.type}</p>
                        <p><strong>Difficulty:</strong> <span style="color: ${getDifficultyColor(clue.difficulty)}">${clue.difficulty}</span></p>
                        <p><strong>Danger Level:</strong> ${clue.danger}/5</p>
                        <button onclick="discoverClue(${index}, ${JSON.stringify(clue).replace(/"/g, '&quot;')})" 
                                style="background: #2ecc71; color: white; border: none; padding: 8px 15px; border-radius: 5px; margin-top: 10px; cursor: pointer;">
                            üìù Record Clue
                        </button>
                    </div>
                `);
            });
        }
        
        // Clue discovery function with danger assessment
        function discoverClue(index, clue) {
            cluesFound++;
            document.getElementById('clueCount').textContent = cluesFound;
            
            // Update danger level based on clues found
            updateDangerLevel(clue.danger);
            
            const clueLog = document.getElementById('clueLog');
            const clueItem = document.createElement('div');
            clueItem.className = 'clue-item';
            clueItem.innerHTML = `
                <div class="clue-title">Clue #${cluesFound}: ${clue.title}</div>
                <p>${clue.content}</p>
                <p style="margin-top: 8px; font-size: 0.9em; color: #666;">
                    <strong>Type:</strong> ${clue.type} | 
                    <strong>Difficulty:</strong> ${clue.difficulty} |
                    <strong>Danger:</strong> ${clue.danger}/5
                </p>
            `;
            
            if (clueLog.children.length === 1 && clueLog.children[0].tagName === 'P') {
                clueLog.innerHTML = '';
            }
            
            clueLog.appendChild(clueItem);
            
            // Check if all clues found
            if (cluesFound === totalClues) {
                setTimeout(() => {
                    alert('üéâ CASE SOLVED! You have successfully tracked the caravan through the Sahara Desert and discovered they were rescued by a nomadic tribe! Excellent detective work!');
                }, 500);
            }
        }
        
        // Update danger level based on investigation progress
        function updateDangerLevel(clueRisk) {
            const avgDanger = (clueRisk + cluesFound) / 2;
            
            if (avgDanger <= 2) {
                dangerLevel = 'Low';
            } else if (avgDanger <= 3.5) {
                dangerLevel = 'Medium';
            } else {
                dangerLevel = 'High';
            }
            
            document.getElementById('dangerLevel').textContent = dangerLevel;
        }
        
        // Helper functions
        function getStatusColor(status) {
            if (status.includes('Active')) return '#2ecc71';
            if (status.includes('Recent')) return '#f39c12';
            if (status.includes('Abandoned')) return '#e74c3c';
            if (status.includes('Search')) return '#3498db';
            return '#333';
        }
        
        function getDifficultyColor(difficulty) {
            switch(difficulty) {
                case 'Easy': return '#2ecc71';
                case 'Medium': return '#f39c12';
                case 'Hard': return '#e74c3c';
                case 'Very Hard': return '#8e44ad';
                default: return '#333';
            }
        }
        
        // Layer toggle functions
        function toggleLayer(layerName) {
            if (saharaMap.hasLayer(layers[layerName])) {
                saharaMap.removeLayer(layers[layerName]);
            } else {
                saharaMap.addLayer(layers[layerName]);
            }
        }
        
        // Investigation panel toggle
        function togglePanel() {
            const panel = document.getElementById('investigationPanel');
            panel.classList.toggle('open');
        }
        
        // Print function
        function printMap() {
            window.print();
        }
        
        // Initialize map with all layers
        function initializeMap() {
            addClimateZones();
            addOases();
            addTradeRoutes();
            addClues();
            
            // Add all layers by default
            Object.values(layers).forEach(layer => {
                saharaMap.addLayer(layer);
            });
            
            // Add scale
            L.control.scale().addTo(saharaMap);
            
            // Add coordinates display on click
            saharaMap.on('click', function(e) {
                console.log(`Clicked at: ${e.latlng.lat.toFixed(4)}, ${e.latlng.lng.toFixed(4)}`);
            });
        }
        
        // Initialize the map when page loads
        document.addEventListener('DOMContentLoaded', initializeMap);
    </script>
</body>
</html>
