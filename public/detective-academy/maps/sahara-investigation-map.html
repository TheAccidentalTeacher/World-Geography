<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèúÔ∏è Sahara Desert Investigation Map - Case #2</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        :root {
            --primary-color: #ff6b35;
            --secondary-color: #4ecdc4;
            --accent-color: #ffd700;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --desert-orange: #d4741c;
            --desert-gold: #f39c12;
            --sand-beige: #f4e4bc;
            --oasis-blue: #0a74da;
        }
        
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
        }
        
        body { 
            font-family: 'Roboto', sans-serif; 
            background: linear-gradient(135deg, #d4741c 0%, #f39c12 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .detective-header {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            padding: 20px;
            text-align: center;
            border-bottom: 4px solid var(--accent-color);
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        
        .case-title {
            font-family: 'Orbitron', monospace;
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--desert-orange);
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .case-subtitle {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 15px;
        }
        
        .mission-brief {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px auto;
            max-width: 800px;
            font-weight: 500;
        }
        
        .map-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.9);
            padding: 15px 20px;
            border-bottom: 2px solid var(--desert-gold);
        }
        
        .control-group {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .detective-btn {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .detective-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        
        .detective-btn.active {
            background: linear-gradient(45deg, var(--success-color), var(--desert-gold));
            box-shadow: 0 0 20px rgba(46, 204, 113, 0.5);
        }
        
        .evidence-counter {
            background: var(--desert-gold);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
        }
        
        #saharaMap {
            height: 70vh;
            width: 100%;
            border: 3px solid var(--desert-gold);
        }
        
        .investigation-panel {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            height: 100vh;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            padding: 20px;
            box-shadow: -5px 0 20px rgba(0,0,0,0.3);
            transition: right 0.3s ease;
            z-index: 1001;
            overflow-y: auto;
        }
        
        .investigation-panel.open {
            right: 0;
        }
        
        .panel-header {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--desert-orange);
            margin-bottom: 20px;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .close-btn {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
            border: 2px solid #e74c3c;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            background: #e74c3c;
            color: white;
            transform: scale(1.1);
        }
        
        .evidence-item {
            background: rgba(243, 156, 18, 0.1);
            border-left: 4px solid var(--desert-gold);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .evidence-item:hover {
            background: rgba(243, 156, 18, 0.2);
            transform: translateX(5px);
        }
        
        .evidence-title {
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            color: var(--desert-orange);
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            cursor: pointer;
            z-index: 1002;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255,255,255,0.9);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        
        .legend-title {
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--desert-orange);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid #333;
        }
        
        @media print {
            .detective-header, .map-controls, .investigation-panel, .back-btn { display: none; }
            #saharaMap { height: 100vh; border: none; }
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="window.location.href='../maps-central.html'">‚Üê Back to Maps Central</button>
    
    <div class="detective-header">
        <h1 class="case-title">üèúÔ∏è CASE #2: SAHARA INVESTIGATION</h1>
        <p class="case-subtitle">Find the Lost Caravan in the World's Largest Hot Desert</p>
        <div class="mission-brief">
            <strong>MISSION:</strong> A merchant caravan led by Omar Bashir has vanished while crossing the Sahara Desert carrying medical supplies. 
            Use this interactive map to analyze desert climate, oases, trade routes, and traditional navigation to track their fate.
        </div>
    </div>
    
    <div class="map-controls">
        <div class="control-group">
            <button class="detective-btn" onclick="toggleLayer('oases')">üíß Oases</button>
            <button class="detective-btn" onclick="toggleLayer('routes')">üõ§Ô∏è Trade Routes</button>
            <button class="detective-btn" onclick="toggleLayer('climate')">üå°Ô∏è Climate Zones</button>
            <button class="detective-btn" onclick="toggleLayer('evidence')">üîç Evidence</button>
        </div>
        <div class="control-group">
            <button class="detective-btn" onclick="toggleLayer('peoples')">üë• Desert Peoples</button>
            <button class="detective-btn" onclick="toggleLayer('landmarks')">üèîÔ∏è Landmarks</button>
            <button class="detective-btn" onclick="toggleLayer('weather')">üå™Ô∏è Weather Hazards</button>
        </div>
        <div class="control-group">
            <div class="evidence-counter">Evidence Found: <span id="evidenceCount">0</span>/8</div>
            <button class="detective-btn" onclick="togglePanel()">üìã Investigation Log</button>
            <button class="detective-btn" onclick="printMap()">üñ®Ô∏è Print Map</button>
        </div>
    </div>
    
    <div id="saharaMap"></div>
    
    <div class="legend">
        <div class="legend-title">Desert Investigation Legend</div>
        <div class="legend-item">
            <div class="legend-color" style="background: #0a74da;"></div>
            <span>Oases & Water Sources</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #f39c12;"></div>
            <span>Ancient Trade Routes</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #e74c3c;"></div>
            <span>Evidence Locations</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #9b59b6;"></div>
            <span>Last Known Position</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #e67e22;"></div>
            <span>Desert Cities</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #8e44ad;"></div>
            <span>Tribal Territories</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #c0392b;"></div>
            <span>Extreme Climate Zones</span>
        </div>
    </div>
    
    <div class="investigation-panel" id="investigationPanel">
        <div class="panel-header">
            üïµÔ∏è Caravan Investigation Log
            <button class="close-btn" onclick="togglePanel()" title="Close Investigation Log">‚úï</button>
        </div>
        <div id="evidenceLog">
            <p style="color: #666; font-style: italic;">Click on evidence markers to record your findings about the lost caravan...</p>
        </div>
    </div>
    
    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // Initialize the map centered on Sahara region (Timbuktu to Taoudenni route)
        const saharaMap = L.map('saharaMap').setView([20.0, 1.0], 5);
        
        // Add multiple base layers for different perspectives
        const baseLayers = {
            'Satellite': L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
            }),
            'Terrain': L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
                attribution: 'Map data: &copy; OpenStreetMap contributors, SRTM | Map style: &copy; OpenTopoMap (CC-BY-SA)'
            }),
            'Desert View': L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            })
        };
        
        // Start with satellite view for better desert visualization
        baseLayers['Satellite'].addTo(saharaMap);
        
        // Add layer control
        L.control.layers(baseLayers).addTo(saharaMap);
        
        // Layer groups for different map elements
        const layers = {
            oases: L.layerGroup(),
            routes: L.layerGroup(),
            climate: L.layerGroup(),
            evidence: L.layerGroup(),
            peoples: L.layerGroup(),
            landmarks: L.layerGroup(),
            weather: L.layerGroup()
        };
        
        // Evidence tracking
        let evidenceFound = 0;
        const totalEvidence = 8;
        
        // Major oases along the caravan route
        const oasisData = [
            {
                name: "Timbuktu",
                coords: [16.7666, -3.0026],
                type: "Departure Point",
                status: "Last confirmed location",
                description: "Ancient trading city. Caravan departed 23 days ago with medical supplies and experienced guide Omar Bashir."
            },
            {
                name: "Taoudenni",
                coords: [22.6761, -3.9833],
                type: "Destination",
                status: "Never arrived",
                description: "Salt mining settlement. Caravan was expected 5 days ago but never arrived. Local authorities initiated search."
            },
            {
                name: "Araouane",
                coords: [18.9045, -3.5272],
                type: "Checkpoint",
                status: "Last communication",
                description: "Remote desert outpost. Last message received 10 days ago reporting on schedule but concerned about weather."
            },
            {
                name: "El Oualata",
                coords: [17.3167, -7.0167],
                type: "Alternative Route",
                status: "No sighting",
                description: "Historic trading post. Local guides report no recent caravan activity."
            }
        ];
        
        // Traditional Saharan trade routes
        const tradeRouteData = [
            {
                name: "Main Timbuktu-Taoudenni Route",
                coords: [[16.7666, -3.0026], [18.9045, -3.5272], [22.6761, -3.9833]],
                color: "#f39c12",
                weight: 6,
                status: "Primary route - 750km journey"
            },
            {
                name: "Eastern Alternative Route",
                coords: [[16.7666, -3.0026], [19.0, -1.0], [22.6761, -3.9833]],
                color: "#e67e22",
                weight: 4,
                status: "Used during sandstorms"
            },
            {
                name: "Trans-Saharan Salt Route",
                coords: [[22.6761, -3.9833], [25.0, 0.0], [27.0, 5.0]],
                color: "#d4a574",
                weight: 4,
                status: "Ancient salt trading path"
            }
        ];
        
        // Climate zones affecting the caravan route
        const climateZoneData = [
            {
                name: "Extreme Arid Zone",
                coords: [[[20.0, -5.0], [25.0, -5.0], [25.0, 2.0], [20.0, 2.0], [20.0, -5.0]]],
                color: "#e74c3c",
                severity: "Critical",
                description: "Less than 25mm annual rainfall. Temperatures exceed 50¬∞C during day."
            },
            {
                name: "Sandstorm Corridor",
                coords: [[[18.0, -4.0], [20.0, -4.0], [20.0, -2.0], [18.0, -2.0], [18.0, -4.0]]],
                color: "#f39c12",
                severity: "High Risk",
                description: "Frequent sandstorms. Harmattan winds create dangerous visibility conditions."
            }
        ];
        
        // Evidence locations related to the missing caravan
        const evidenceData = [
            {
                coords: [16.7666, -3.0026],
                title: "Departure Records",
                content: "Official caravan departure logs from Timbuktu. 12 people, 18 camels, medical supplies valued at $2.3M. Omar Bashir (guide) has 30+ years experience.",
                type: "document",
                difficulty: "Easy"
            },
            {
                coords: [18.9045, -3.5272],
                title: "Last Radio Contact",
                content: "Final radio message from Araouane checkpoint: 'On schedule but unusual weather patterns ahead. Considering route adjustment.' Timestamp: 10 days ago.",
                type: "communication",
                difficulty: "Easy"
            },
            {
                coords: [19.5, -3.2],
                title: "Abandoned Cargo",
                content: "Medical supply containers found 70km east of planned route. Nomadic herder reports seeing tracks heading toward singing dunes area.",
                type: "physical",
                difficulty: "Medium"
            },
            {
                coords: [20.2, -2.8],
                title: "Camel Tracks",
                content: "Fresh camel tracks found leading toward remote wadi. Pattern suggests 18 animals traveling in formation typical of experienced caravan leader.",
                type: "tracking",
                difficulty: "Medium"
            },
            {
                coords: [20.8, -2.5],
                title: "Torn Map Fragment",
                content: "Piece of navigation map caught on acacia tree. Shows hand-drawn markings indicating water source not on official maps. Traditional Tuareg navigation symbols.",
                type: "navigation",
                difficulty: "Hard"
            },
            {
                coords: [21.3, -2.1],
                title: "Emergency Signal",
                content: "Weak emergency beacon detected in wadi area. Signal intermittent but suggests sheltered location. GPS coordinates match traditional shelter sites.",
                type: "signal",
                difficulty: "Hard"
            },
            {
                coords: [21.6, -1.8],
                title: "Tuareg Guide Interview",
                content: "Local Tuareg guide reports massive sandstorm 8 days ago forced travelers to seek shelter. Describes traditional survival techniques in hidden wadi.",
                type: "testimony",
                difficulty: "Very Hard"
            },
            {
                coords: [21.8, -1.5],
                title: "Hidden Wadi Discovery",
                content: "CARAVAN FOUND! All members alive in protected wadi using traditional survival methods. Omar Bashir's experience and local knowledge saved the group during unprecedented sandstorm.",
                type: "resolution",
                difficulty: "Very Hard"
            }
        ];
        
        // Desert peoples and their territories
        const desertPeoplesData = [
            {
                name: "Tuareg Territory",
                coords: [20.0, -2.0],
                people: "Tuareg",
                knowledge: "Expert desert navigation, traditional water finding techniques",
                description: "The 'Blue People' of the Sahara. Masters of desert survival and navigation."
            },
            {
                name: "Berber Lands",
                coords: [25.0, 0.0],
                people: "Berber",
                knowledge: "Ancient trade route knowledge, astronomical navigation",
                description: "Indigenous North African peoples with thousands of years of desert experience."
            },
            {
                name: "Toubou Region",
                coords: [18.0, 15.0],
                people: "Toubou",
                knowledge: "Survival in extreme conditions, traditional medicine",
                description: "Skilled desert dwellers known for adapting to harsh environments."
            }
        ];
        
        // Add oases and water sources
        function addOases() {
            oasisData.forEach(oasis => {
                const oasisIcon = L.divIcon({
                    className: 'oasis-marker',
                    html: `<div style="background: #0a74da; border: 3px solid white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-size: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">üíß</div>`,
                    iconSize: [30, 30],
                    iconAnchor: [15, 15]
                });
                
                const marker = L.marker(oasis.coords, { icon: oasisIcon }).addTo(layers.oases);
                
                marker.bindPopup(`
                    <div style="font-family: 'Roboto', sans-serif; min-width: 200px;">
                        <h3 style="color: #0a74da; margin-bottom: 10px;">${oasis.name}</h3>
                        <p><strong>Type:</strong> ${oasis.type}</p>
                        <p><strong>Status:</strong> <span style="color: ${getStatusColor(oasis.status)}">${oasis.status}</span></p>
                        <p style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;">${oasis.description}</p>
                    </div>
                `);
            });
        }
        
        // Add trade routes
        function addTradeRoutes() {
            tradeRouteData.forEach(route => {
                const routeLine = L.polyline(route.coords, {
                    color: route.color,
                    weight: route.weight,
                    opacity: 0.8
                }).addTo(layers.routes);
                
                routeLine.bindPopup(`
                    <div style="font-family: 'Roboto', sans-serif;">
                        <h3 style="color: ${route.color}; margin-bottom: 10px;">${route.name}</h3>
                        <p><strong>Status:</strong> ${route.status}</p>
                        <p>Traditional caravan route used for centuries by desert traders.</p>
                    </div>
                `);
            });
        }
        
        // Add climate zones
        function addClimateZones() {
            climateZoneData.forEach(zone => {
                const polygon = L.polygon(zone.coords, {
                    color: zone.color,
                    fillColor: zone.color,
                    fillOpacity: 0.3,
                    weight: 2
                }).addTo(layers.climate);
                
                polygon.bindPopup(`
                    <div style="font-family: 'Roboto', sans-serif;">
                        <h3 style="color: ${zone.color}; margin-bottom: 10px;">${zone.name}</h3>
                        <p><strong>Severity:</strong> <span style="color: ${zone.color}">${zone.severity}</span></p>
                        <p style="margin-top: 10px;">${zone.description}</p>
                    </div>
                `);
            });
        }
        
        // Add evidence markers
        function addEvidence() {
            evidenceData.forEach((evidence, index) => {
                const evidenceIcon = L.divIcon({
                    className: 'evidence-marker',
                    html: `<div style="background: #e74c3c; border: 3px solid white; border-radius: 50%; width: 25px; height: 25px; display: flex; align-items: center; justify-content: center; font-size: 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.3); cursor: pointer;">üîç</div>`,
                    iconSize: [25, 25],
                    iconAnchor: [12.5, 12.5]
                });
                
                const marker = L.marker(evidence.coords, { icon: evidenceIcon }).addTo(layers.evidence);
                
                marker.on('click', function() {
                    discoverEvidence(index, evidence);
                });
                
                marker.bindPopup(`
                    <div style="font-family: 'Roboto', sans-serif; min-width: 250px;">
                        <h3 style="color: #e74c3c; margin-bottom: 10px;">üîç ${evidence.title}</h3>
                        <p style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 10px;">${evidence.content}</p>
                        <p><strong>Type:</strong> ${evidence.type}</p>
                        <p><strong>Difficulty:</strong> <span style="color: ${getDifficultyColor(evidence.difficulty)}">${evidence.difficulty}</span></p>
                        <button onclick="discoverEvidence(${index}, ${JSON.stringify(evidence).replace(/"/g, '&quot;')})" 
                                style="background: #2ecc71; color: white; border: none; padding: 8px 15px; border-radius: 5px; margin-top: 10px; cursor: pointer;">
                            üìù Record Evidence
                        </button>
                    </div>
                `);
            });
        }
        
        // Add desert peoples territories
        function addDesertPeoples() {
            desertPeoplesData.forEach(people => {
                const peopleIcon = L.divIcon({
                    className: 'people-marker',
                    html: `<div style="background: #8e44ad; border: 3px solid white; border-radius: 50%; width: 25px; height: 25px; display: flex; align-items: center; justify-content: center; font-size: 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">üë•</div>`,
                    iconSize: [25, 25],
                    iconAnchor: [12.5, 12.5]
                });
                
                const marker = L.marker(people.coords, { icon: peopleIcon }).addTo(layers.peoples);
                
                marker.bindPopup(`
                    <div style="font-family: 'Roboto', sans-serif;">
                        <h3 style="color: #8e44ad; margin-bottom: 10px;">${people.name}</h3>
                        <p><strong>People:</strong> ${people.people}</p>
                        <p><strong>Traditional Knowledge:</strong> ${people.knowledge}</p>
                        <p style="margin-top: 10px; font-style: italic;">${people.description}</p>
                    </div>
                `);
            });
        }
        
        // Add landmarks and singing dunes
        function addLandmarks() {
            const landmarks = [
                {
                    name: "The Singing Dunes",
                    coords: [20.5, -2.3],
                    description: "Mysterious dunes that produce musical sounds when wind passes over them. Traditional navigation landmark."
                },
                {
                    name: "Hidden Wadi",
                    coords: [21.8, -1.5],
                    description: "Protected valley offering shelter from sandstorms. Known to experienced desert guides."
                }
            ];
            
            landmarks.forEach(landmark => {
                const landmarkIcon = L.divIcon({
                    className: 'landmark-marker',
                    html: `<div style="background: #f39c12; border: 3px solid white; border-radius: 50%; width: 25px; height: 25px; display: flex; align-items: center; justify-content: center; font-size: 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">üèîÔ∏è</div>`,
                    iconSize: [25, 25],
                    iconAnchor: [12.5, 12.5]
                });
                
                const marker = L.marker(landmark.coords, { icon: landmarkIcon }).addTo(layers.landmarks);
                
                marker.bindPopup(`
                    <div style="font-family: 'Roboto', sans-serif;">
                        <h3 style="color: #f39c12; margin-bottom: 10px;">${landmark.name}</h3>
                        <p>${landmark.description}</p>
                    </div>
                `);
            });
        }
        
        // Add weather hazards
        function addWeatherHazards() {
            const hazards = [
                {
                    name: "Sandstorm Zone",
                    coords: [19.0, -3.0],
                    type: "Active weather system",
                    description: "Major sandstorm occurred 8 days ago. Visibility reduced to zero for 72 hours."
                }
            ];
            
            hazards.forEach(hazard => {
                const hazardIcon = L.divIcon({
                    className: 'weather-marker',
                    html: `<div style="background: #c0392b; border: 3px solid white; border-radius: 50%; width: 25px; height: 25px; display: flex; align-items: center; justify-content: center; font-size: 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">üå™Ô∏è</div>`,
                    iconSize: [25, 25],
                    iconAnchor: [12.5, 12.5]
                });
                
                const marker = L.marker(hazard.coords, { icon: hazardIcon }).addTo(layers.weather);
                
                marker.bindPopup(`
                    <div style="font-family: 'Roboto', sans-serif;">
                        <h3 style="color: #c0392b; margin-bottom: 10px;">${hazard.name}</h3>
                        <p><strong>Type:</strong> ${hazard.type}</p>
                        <p>${hazard.description}</p>
                    </div>
                `);
            });
        }
        
        // Evidence discovery function
        function discoverEvidence(index, evidence) {
            evidenceFound++;
            document.getElementById('evidenceCount').textContent = evidenceFound;
            
            const evidenceLog = document.getElementById('evidenceLog');
            const evidenceItem = document.createElement('div');
            evidenceItem.className = 'evidence-item';
            evidenceItem.innerHTML = `
                <div class="evidence-title">Evidence #${evidenceFound}: ${evidence.title}</div>
                <p><strong>Type:</strong> ${evidence.type}</p>
                <p style="margin-top: 8px;">${evidence.content}</p>
                <p style="margin-top: 8px; font-size: 0.9em; color: #666;">
                    <strong>Difficulty:</strong> ${evidence.difficulty}
                </p>
            `;
            
            if (evidenceLog.children.length === 1 && evidenceLog.children[0].tagName === 'P') {
                evidenceLog.innerHTML = '';
            }
            
            evidenceLog.appendChild(evidenceItem);
            
            // Check if caravan found
            if (evidenceFound === totalEvidence) {
                setTimeout(() => {
                    alert('üéâ CARAVAN FOUND! Omar Bashir\'s experience and traditional desert knowledge saved all 12 members during the massive sandstorm. They used Tuareg survival techniques to shelter in a hidden wadi until rescue arrived. Case #2 SOLVED!');
                }, 500);
            }
        }
        
        // Helper functions
        function getStatusColor(status) {
            if (status.includes('confirmed')) return '#2ecc71';
            if (status.includes('Never')) return '#e74c3c';
            if (status.includes('Last')) return '#f39c12';
            if (status.includes('No')) return '#95a5a6';
            return '#333';
        }
        
        function getDifficultyColor(difficulty) {
            switch(difficulty) {
                case 'Easy': return '#2ecc71';
                case 'Medium': return '#f39c12';
                case 'Hard': return '#e74c3c';
                case 'Very Hard': return '#8e44ad';
                default: return '#333';
            }
        }
        
        // Layer toggle functions
        function toggleLayer(layerName) {
            const button = event.target;
            
            if (saharaMap.hasLayer(layers[layerName])) {
                saharaMap.removeLayer(layers[layerName]);
                button.classList.remove('active');
            } else {
                saharaMap.addLayer(layers[layerName]);
                button.classList.add('active');
            }
        }
        
        // Investigation panel toggle
        function togglePanel() {
            const panel = document.getElementById('investigationPanel');
            panel.classList.toggle('open');
        }
        
        // Print function
        function printMap() {
            window.print();
        }
        
        // Initialize map with all layers
        function initializeMap() {
            addOases();
            addTradeRoutes();
            addClimateZones();
            addEvidence();
            addDesertPeoples();
            addLandmarks();
            addWeatherHazards();
            
            // Add all layers by default
            Object.values(layers).forEach(layer => {
                saharaMap.addLayer(layer);
            });
            
            // Set all layer buttons as active by default
            const layerButtons = document.querySelectorAll('[onclick*="toggleLayer"]');
            layerButtons.forEach(button => {
                button.classList.add('active');
            });
            
            // Add scale
            L.control.scale().addTo(saharaMap);
            
            // Add coordinates display on click
            saharaMap.on('click', function(e) {
                console.log(`Clicked at: ${e.latlng.lat.toFixed(4)}, ${e.latlng.lng.toFixed(4)}`);
            });
        }
        
        // Initialize the map when page loads
        document.addEventListener('DOMContentLoaded', initializeMap);
    </script>
</body>
</html>
