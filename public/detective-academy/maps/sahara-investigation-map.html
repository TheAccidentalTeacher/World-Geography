<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÔøΩÔ∏è Sahara Desert Investigation Map - Case #2</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Leaflet CSS -->        const overlayLa        const layers = {
            rivers: overlayL                name: "Siwa Oasis Station",
                coords: [29.2022, 25.5198],
                status: "Contact Lost"        // Add trade routes to map
        function addTradeRoutes() {
            tradeRouteData.forEach(route => {
                const routeLine = L.polyline(route.coords, {
                    color: route.color,
                    weight: route.weight,
                    opacity: 0.8
                }).addTo(layers.rivers);
                
                routeLine.bindPopup(`
                    <div style="font-family: 'Roboto', sans-serif;">
                        <h3 style="color: #d4a574; margin-bottom: 10px;">${route.name}</h3>
                        <p><strong>Navigation:</strong> Dr. Hassan's likely route</p>      lastContact: "Day 3", 
                description: "Local guides confirm Dr. Hassan passed through. Collected pottery samples."
            },
            {
                name: "Remote Outpost Alpha",
                coords: [23.5, 15.0],
                status: "Unknown",
                lastContact: "Day 5",
                description: "Emergency beacon activated briefly. No response to radio calls."
            }de Routes'],
            vegetation: overlayLayers['üåø Vegetation Zones'],
            stations: overlayLayers['üèóÔ∏è Research Stations'],
            evidence: overlayLayers['üéØ Evidence Locations'],
            cities: overlayLayers['üèôÔ∏è Major Cities'],
            indigenous: overlayLayers['üèõÔ∏è Indigenous Territories'],
            deforestation: overlayLayers['üî• Deforestation Zones']
        };
            'üåä Trade Routes': L.layerGroup(),
            'üåø Vegetation Zones': L.layerGroup(),
            'üèóÔ∏è Research Stations': L.layerGroup(),
            'üéØ Evidence Locations': L.layerGroup(),
            'üèôÔ∏è Major Cities': L.layerGroup(),
            'üèõÔ∏è Indigenous Territories': L.layerGroup(),
            'üî• Deforestation Zones': L.layerGroup()
        };nk rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Leaflet Plugins -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-draw@1.0.4/dist/leaflet.draw.css"/>
    
    <style>
        :root {
            --primary-color: #ff6b35;
            --secondary-color: #4ecdc4;
            --accent-color: #ffd700;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --sahara-sand: #d4a574;
            --sahara-deep: #b8956a;
            --sahara-light: #e6c794;
            --oasis-blue: #0a74da;
        }
        
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
        }
        
        body { 
            font-family: 'Roboto', sans-serif; 
            background: linear-gradient(135deg, #d4a574 0%, #b8956a 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .detective-header {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            padding: 20px;
            text-align: center;
            border-bottom: 4px solid var(--accent-color);
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        
        .case-title {
            font-family: 'Orbitron', monospace;
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--sahara-deep);
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .case-subtitle {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 15px;
        }
        
        .mission-brief {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px auto;
            max-width: 800px;
            font-weight: 500;
        }
        
        .map-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.9);
            padding: 15px 20px;
            border-bottom: 2px solid var(--sahara-deep);
        }
        
        .control-group {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .detective-btn {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .detective-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        
        .detective-btn.active {
            background: linear-gradient(45deg, var(--success-color), var(--sahara-deep));
            box-shadow: 0 0 20px rgba(46, 204, 113, 0.5);
        }
        
        .evidence-counter {
            background: var(--success-color);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
        }
        
        #saharaMap {
            height: 70vh;
            width: 100%;
            border: 3px solid var(--sahara-light);
        }
        
        .investigation-panel {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            height: 100vh;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            padding: 20px;
            box-shadow: -5px 0 20px rgba(0,0,0,0.3);
            transition: right 0.3s ease;
            z-index: 1001;
            overflow-y: auto;
        }
        
        .investigation-panel.open {
            right: 0;
        }
        
        .panel-header {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--sahara-deep);
            margin-bottom: 20px;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .close-btn {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
            border: 2px solid #e74c3c;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            background: #e74c3c;
            color: white;
            transform: scale(1.1);
        }
        
        .evidence-item {
            background: rgba(46, 204, 113, 0.1);
            border-left: 4px solid var(--sahara-deep);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .evidence-item:hover {
            background: rgba(46, 204, 113, 0.2);
            transform: translateX(5px);
        }
        
        .evidence-title {
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            color: var(--sahara-deep);
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        
        .evidence-item {
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--sahara-light);
        }
        
        .evidence-title {
            font-weight: 700;
            color: var(--sahara-deep);
            margin-bottom: 8px;
        }
        
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            cursor: pointer;
            z-index: 1002;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255,255,255,0.9);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        
        .legend-title {
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--sahara-deep);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid #333;
        }
        
        @media print {
            .detective-header, .map-controls, .investigation-panel, .back-btn { display: none; }
            #saharaMap { height: 100vh; border: none; }
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="window.location.href='/detective-academy/maps-central'">‚Üê Back to Maps Central</button>
    
    <div class="detective-header">
        <h1 class="case-title">ÔøΩÔ∏è Sahara Desert Investigation</h1>
        <p class="case-subtitle">Case #2: The Missing Archaeologist</p>
        <div class="mission-brief">
            üîç <strong>Mission:</strong> Dr. Sarah Hassan has vanished while researching ancient trade routes in the Sahara. Use the interactive map to track her last known locations through oases, archaeological sites, and trade routes. Discover evidence and solve the mystery of her disappearance!
        </div>
    </div>
    
    <div class="map-controls">
        <div class="control-group">
            <button class="detective-btn" onclick="toggleLayer('oases')">üíß Oases</button>
            <button class="detective-btn" onclick="toggleLayer('tradeRoutes')">üê™ Trade Routes</button>
            <button class="detective-btn" onclick="toggleLayer('evidence')">üîç Evidence</button>
            <button class="detective-btn" onclick="toggleLayer('archaeological')">üè∫ Archaeological Sites</button>
        </div>
        <div class="control-group">
            <button class="detective-btn" onclick="toggleLayer('settlements')">üèòÔ∏è Settlements</button>
            <button class="detective-btn" onclick="toggleLayer('climate')">üå°Ô∏è Climate Zones</button>
        </div>
        <div class="control-group">
            <div class="evidence-counter">Evidence Found: <span id="evidenceCount">0</span>/8</div>
            <button class="detective-btn" onclick="togglePanel()">üìã Investigation Notes</button>
            <button class="detective-btn" onclick="printMap()">üñ®Ô∏è Print Map</button>
        </div>
    </div>
    
    <div id="saharaMap"></div>
    
    <div class="legend">
        <div class="legend-title">Map Legend</div>
        <div class="legend-item">
            <div class="legend-color" style="background: #0077be;"></div>
            <span>Major Rivers</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #2ecc71;"></div>
            <span>Dense Forest</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #f39c12;"></div>
            <span>Research Stations</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #e74c3c;"></div>
            <span>Evidence Locations</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #9b59b6;"></div>
            <span>Last Known Position</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #e67e22;"></div>
            <span>Major Cities</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #8e44ad;"></div>
            <span>Indigenous Areas</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #c0392b;"></div>
            <span>Deforestation Zones</span>
        </div>
    </div>
    
    <div class="investigation-panel" id="investigationPanel">
        <div class="panel-header">
            üïµÔ∏è Investigation Log
            <button class="close-btn" onclick="togglePanel()" title="Close Investigation Log">‚úï</button>
        </div>
        <div id="evidenceLog">
            <p style="color: #666; font-style: italic;">Click on evidence markers to record your findings...</p>
        </div>
    </div>
    
    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
    
    <script>
        // Initialize the map centered on Sahara region
        const saharaMap = L.map('saharaMap').setView([20.0, 10.0], 5);
        
        // Add multiple professional base layers like Google Maps
        const baseLayers = {
            'Satellite': L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
            }),
            'Street Map': L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }),
            'Countries & Boundaries': L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }),
            'Terrain & Elevation': L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
                attribution: 'Map data: &copy; OpenStreetMap contributors, SRTM | Map style: &copy; OpenTopoMap (CC-BY-SA)'
            }),
            'Dark Mode': L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; OpenStreetMap contributors &copy; CARTO'
            }),
            'Physical Features': L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Physical_Map/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles &copy; Esri &mdash; Source: US National Park Service'
            })
        };
        
        // Start with satellite view for better Sahara visualization
        baseLayers['Satellite'].addTo(saharaMap);
        
        // Create enhanced layer control with base maps and overlays separate
        const layerControl = L.control.layers(baseLayers, {}, {
            position: 'topright',
            collapsed: false
        }).addTo(saharaMap);
        
        // Layer groups for different map elements (overlays only)
        const overlayLayers = {
            'üåä Trade Routes': L.layerGroup(),
            'üå≥ Vegetation Zones': L.layerGroup(), 
            'üè¢ Research Stations': L.layerGroup(),
            'üîç Evidence Locations': L.layerGroup(),
            'üèôÔ∏è Major Cities': L.layerGroup(),
            'üèòÔ∏è Indigenous Territories': L.layerGroup(),
            'üî• Deforestation Zones': L.layerGroup()
        };
        
        // Add overlay layers to the control
        Object.entries(overlayLayers).forEach(([name, layer]) => {
            layerControl.addOverlay(layer, name);
        });
        
        // Keep internal reference for easy access
        const layers = {
            rivers: overlayLayers['üåä Trade Routes'],
            vegetation: overlayLayers['ÔøΩ Vegetation Zones'],
            stations: overlayLayers['ÔøΩÔ∏è Research Stations'], 
            evidence: overlayLayers['üéØ Evidence Locations'],
            cities: overlayLayers['üèôÔ∏è Major Cities'],
            indigenous: overlayLayers['ÔøΩÔ∏è Indigenous Territories'],
            deforestation: overlayLayers['üî• Deforestation Zones']
        };
        
        // Evidence tracking
        let evidenceFound = 0;
        const totalEvidence = 8;
        
        // Sahara trade routes and oasis data
        const tradeRouteData = [
            {
                name: "Trans-Saharan Trade Route",
                coords: [[31.2001, 29.9187], [25.6892, 32.6407], [16.7666, 3.0026], [12.6392, -7.9465]],
                color: "#d4a574",
                weight: 6
            },
            {
                name: "Salt Route to Timbuktu",
                coords: [[25.0, 0.0], [20.0, -1.0], [16.7666, -3.0026]],
                color: "#b8956a",
                weight: 4
            },
            {
                name: "Nile Trade Connection",
                coords: [[31.2357, 30.0444], [25.6892, 32.6407], [15.5007, 32.5599]],
                color: "#0a74da",
                weight: 4
            }
        ];
        
        // Research stations data
        const stationData = [
            {
                name: "Cairo Research Station",
                coords: [30.0444, 31.2357],
                status: "Active",
                lastContact: "Day 1",
                description: "Dr. Hassan's starting point. GPS logs show departure heading southwest into the desert."
            },
            {
                name: "Tefe Field Station",
                coords: [-3.3514, -64.7103],
                status: "Visited",
                lastContact: "Day 3",
                description: "Local guides confirm Dr. Hassan passed through. Collected pottery samples."
            },
            {
                name: "Remote Outpost Alpha",
                coords: [-4.2558, -69.9406],
                status: "Unknown",
                lastContact: "Day 5",
                description: "Emergency beacon activated briefly. No response to radio calls."
            }
        ];
        
        // Evidence locations with educational content
        const evidenceData = [
            {
                coords: [30.0444, 31.2357],
                title: "Research Notes",
                content: "Dr. Hassan's notebook found at hotel. Shows interest in ancient trade route patterns across the desert.",
                type: "document",
                difficulty: "Easy"
            },
            {
                coords: [29.2022, 25.5198],
                title: "GPS Device",
                content: "Handheld GPS shows waypoints leading deeper into desert. Battery at 23%.",
                type: "technology",
                difficulty: "Medium"
            },
            {
                coords: [23.5, 15.0],
                title: "Camel Gear",
                content: "Damaged saddle found at oasis. Indicates possible navigation difficulties.",
                type: "physical",
                difficulty: "Medium"
            },
            {
                coords: [21.0, 12.0],
                title: "Emergency Beacon Signal",
                content: "Weak signal detected. Triangulation suggests location in remote dune area.",
                type: "signal",
                difficulty: "Hard"
            },
            {
                coords: [22.5, 13.5],
                title: "Local Witness Account",
                content: "Tuareg guide reports seeing researcher heading toward ancient caravan route.",
                type: "testimony",
                difficulty: "Medium"
            },
            {
                coords: [20.5, 11.0],
                title: "Satellite Phone",
                content: "Found damaged satellite phone. Last message mentions 'unusual archaeological pattern discovered'.",
                type: "technology",
                difficulty: "Hard"
            },
            {
                coords: [19.5, 10.0],
                title: "Campsite Remains",
                content: "Temporary camp with research equipment. Shows signs of hasty departure.",
                type: "physical",
                difficulty: "Hard"
            },
            {
                coords: [18.0, 9.0],
                title: "Final Radio Transmission",
                content: "Last known communication: 'Have made significant discovery. Coordinates follow...' [TRANSMISSION ENDS]",
                type: "signal",
                difficulty: "Very Hard"
            }
        ];
        
        // Major cities data
        const cityData = [
            { name: "Cairo", coords: [30.0444, 31.2357], population: "10.1M", country: "Egypt" },
            { name: "Algiers", coords: [36.7525, 3.0420], population: "2.9M", country: "Algeria" },
            { name: "Tripoli", coords: [32.8925, 13.1802], population: "1.1M", country: "Libya" },
            { name: "Khartoum", coords: [15.5007, 32.5599], population: "5.2M", country: "Sudan" },
            { name: "Casablanca", coords: [33.5731, -7.5898], population: "3.7M", country: "Morocco" },
            { name: "Tunis", coords: [36.8065, 10.1815], population: "2.4M", country: "Tunisia" }
        ];
        
        // Indigenous territories data
        const indigenousData = [
            { name: "Tuareg Territory", coords: [20.0, 5.0], area: "Traditional Lands", people: "Tuareg" },
            { name: "Berber Territory", coords: [31.0, -5.0], area: "Cultural Preserve", people: "Berber" },
            { name: "Tebu Territory", coords: [18.0, 23.0], area: "Protected Area", people: "Tebu" },
            { name: "Fulani Territory", coords: [12.0, 2.0], area: "Pastoral Lands", people: "Fulani" },
            { name: "Sahrawi Territory", coords: [25.0, -13.0], area: "Disputed Region", people: "Sahrawi" }
        ];
        
        // Desertification zones data
        const desertificationData = [
            { 
                name: "Sahel Degradation Zone", 
                coords: [[10.0, -15.0], [18.0, -10.0], [18.0, 20.0], [10.0, 15.0], [10.0, -15.0]],
                severity: "High",
                year: "2020-2024"
            },
            {
                name: "Lake Chad Basin",
                coords: [[12.0, 13.0], [14.0, 13.0], [14.0, 15.0], [12.0, 15.0], [12.0, 13.0]],
                severity: "Critical",
                year: "2022-2024"
            },
            {
                name: "Atlas Mountains Foothills",
                coords: [[31.0, -8.0], [33.0, -8.0], [33.0, -5.0], [31.0, -5.0], [31.0, -8.0]],
                severity: "Moderate",
                year: "2021-2023"
            }
        ];
        
        // Add rivers to map
        function addTradeRoutes() {
            tradeRouteData.forEach(river => {
                const riverLine = L.polyline(river.coords, {
                    color: river.color,
                    weight: river.weight,
                    opacity: 0.8
                }).addTo(layers.rivers);
                
                riverLine.bindPopup(`
                    <div style="font-family: 'Roboto', sans-serif;">
                        <h3 style="color: #0077be; margin-bottom: 10px;">${river.name}</h3>
                        <p><strong>Length:</strong> Major waterway</p>
                        <p><strong>Navigation:</strong> Dr. Hassan's likely route</p>
                        <p><strong>Current:</strong> Moderate to strong</p>
                    </div>
                `);
            });
        }
        
        // Add research stations
        function addStations() {
            stationData.forEach(station => {
                const stationIcon = L.divIcon({
                    className: 'station-marker',
                    html: `<div style="background: #f39c12; border: 3px solid white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-size: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">üè†</div>`,
                    iconSize: [30, 30],
                    iconAnchor: [15, 15]
                });
                
                const marker = L.marker(station.coords, { icon: stationIcon }).addTo(layers.stations);
                
                marker.bindPopup(`
                    <div style="font-family: 'Roboto', sans-serif; min-width: 200px;">
                        <h3 style="color: #f39c12; margin-bottom: 10px;">${station.name}</h3>
                        <p><strong>Status:</strong> <span style="color: ${station.status === 'Active' ? '#2ecc71' : station.status === 'Visited' ? '#f39c12' : '#e74c3c'}">${station.status}</span></p>
                        <p><strong>Last Contact:</strong> ${station.lastContact}</p>
                        <p style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;">${station.description}</p>
                    </div>
                `);
            });
        }
        
        // Add evidence markers with interactive discovery
        function addEvidence() {
            evidenceData.forEach((evidence, index) => {
                const evidenceIcon = L.divIcon({
                    className: 'evidence-marker',
                    html: `<div style="background: #e74c3c; border: 3px solid white; border-radius: 50%; width: 25px; height: 25px; display: flex; align-items: center; justify-content: center; font-size: 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.3); cursor: pointer;">üîç</div>`,
                    iconSize: [25, 25],
                    iconAnchor: [12.5, 12.5]
                });
                
                const marker = L.marker(evidence.coords, { icon: evidenceIcon }).addTo(layers.evidence);
                
                marker.on('click', function() {
                    recordEvidence(index);
                });
                
                marker.bindPopup(`
                    <div style="font-family: 'Roboto', sans-serif; min-width: 250px;">
                        <h3 style="color: #e74c3c; margin-bottom: 10px;">üîç ${evidence.title}</h3>
                        <p style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 10px;">${evidence.content}</p>
                        <p><strong>Evidence Type:</strong> ${evidence.type}</p>
                        <p><strong>Difficulty:</strong> <span style="color: ${getDifficultyColor(evidence.difficulty)}">${evidence.difficulty}</span></p>
                        <button onclick="recordEvidence(${index})" 
                                style="background: #2ecc71; color: white; border: none; padding: 8px 15px; border-radius: 5px; margin-top: 10px; cursor: pointer;">
                            üìù Record Evidence
                        </button>
                    </div>
                `);
            });
        }
        
        // Add major cities
        function addCities() {
            cityData.forEach(city => {
                const cityIcon = L.divIcon({
                    className: 'city-marker',
                    html: `<div style="background: #e67e22; border: 3px solid white; border-radius: 8px; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; font-size: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">üèôÔ∏è</div>`,
                    iconSize: [32, 32],
                    iconAnchor: [16, 16]
                });
                
                const marker = L.marker(city.coords, { icon: cityIcon }).addTo(layers.cities);
                
                marker.bindPopup(`
                    <div style="font-family: 'Roboto', sans-serif; min-width: 200px;">
                        <h3 style="color: #e67e22; margin-bottom: 10px;">üèôÔ∏è ${city.name}</h3>
                        <p><strong>Country:</strong> ${city.country}</p>
                        <p><strong>Population:</strong> ${city.population}</p>
                        <p><strong>Role:</strong> Regional hub for Sahara research and logistics</p>
                        <p style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;">Key staging point for Dr. Hassan's expedition supplies and communications.</p>
                    </div>
                `);
            });
        }
        
        // Add indigenous territories
        function addIndigenous() {
            indigenousData.forEach(territory => {
                const territoryIcon = L.divIcon({
                    className: 'indigenous-marker',
                    html: `<div style="background: #8e44ad; border: 3px solid white; border-radius: 50%; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; font-size: 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">üèïÔ∏è</div>`,
                    iconSize: [28, 28],
                    iconAnchor: [14, 14]
                });
                
                const marker = L.marker(territory.coords, { icon: territoryIcon }).addTo(layers.indigenous);
                
                marker.bindPopup(`
                    <div style="font-family: 'Roboto', sans-serif; min-width: 250px;">
                        <h3 style="color: #8e44ad; margin-bottom: 10px;">üèïÔ∏è ${territory.name}</h3>
                        <p><strong>People:</strong> ${territory.people}</p>
                        <p><strong>Status:</strong> ${territory.area}</p>
                        <p><strong>Cultural Significance:</strong> Traditional guardians of the desert</p>
                        <p style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;">Indigenous communities possess invaluable knowledge about Dr. Hassan's research area and local environmental changes.</p>
                    </div>
                `);
            });
        }
        
        // Add desertification zones
        function addDesertification() {
            desertificationData.forEach(zone => {
                const desertificationZone = L.polygon(zone.coords, {
                    color: '#c0392b',
                    weight: 2,
                    opacity: 0.8,
                    fillColor: '#c0392b',
                    fillOpacity: 0.3
                }).addTo(layers.deforestation);
                
                desertificationZone.bindPopup(`
                    <div style="font-family: 'Roboto', sans-serif; min-width: 250px;">
                        <h3 style="color: #c0392b; margin-bottom: 10px;">üèúÔ∏è ${zone.name}</h3>
                        <p><strong>Severity:</strong> <span style="color: ${zone.severity === 'Critical' ? '#e74c3c' : zone.severity === 'High' ? '#f39c12' : '#f1c40f'}">${zone.severity}</span></p>
                        <p><strong>Period:</strong> ${zone.year}</p>
                        <p><strong>Environmental Impact:</strong> Significant land degradation</p>
                        <p style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;">Dr. Hassan's research focused on understanding the connection between desertification patterns and ancient settlement locations in these critical areas.</p>
                    </div>
                `);
            });
        }
        
        // Evidence discovery function
        let discoveredEvidence = new Set(); // Track which evidence has been found
        
        function recordEvidence(index) {
            // Prevent duplicate discoveries
            if (discoveredEvidence.has(index)) {
                alert('You have already recorded this evidence!');
                return;
            }
            
            const evidence = evidenceData[index];
            discoveredEvidence.add(index);
            evidenceFound++;
            document.getElementById('evidenceCount').textContent = evidenceFound;
            
            const evidenceLog = document.getElementById('evidenceLog');
            const evidenceItem = document.createElement('div');
            evidenceItem.className = 'evidence-item';
            evidenceItem.innerHTML = `
                <div class="evidence-title">Evidence #${evidenceFound}: ${evidence.title}</div>
                <p>${evidence.content}</p>
                <p style="margin-top: 8px; font-size: 0.9em; color: #666;">
                    <strong>Type:</strong> ${evidence.type} | 
                    <strong>Difficulty:</strong> ${evidence.difficulty}
                </p>
                <hr style="margin: 10px 0; border: 1px solid #eee;">
            `;
            
            if (evidenceLog.children.length === 1 && evidenceLog.children[0].tagName === 'P') {
                evidenceLog.innerHTML = '';
            }
            
            evidenceLog.appendChild(evidenceItem);
            
            // Show investigation panel if not open
            const panel = document.getElementById('investigationPanel');
            if (!panel.classList.contains('open')) {
                panel.classList.add('open');
            }
            
            // Change marker appearance to show it's been discovered
            const marker = layers.evidence.getLayers().find(layer => 
                layer.getLatLng().lat === evidence.coords[0] && 
                layer.getLatLng().lng === evidence.coords[1]
            );
            
            if (marker) {
                const newIcon = L.divIcon({
                    className: 'evidence-marker-found',
                    html: `<div style="background: #2ecc71; border: 3px solid white; border-radius: 50%; width: 25px; height: 25px; display: flex; align-items: center; justify-content: center; font-size: 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.3); cursor: pointer;">‚úì</div>`,
                    iconSize: [25, 25],
                    iconAnchor: [12.5, 12.5]
                });
                marker.setIcon(newIcon);
            }
            
            // Check if all evidence found
            if (evidenceFound === totalEvidence) {
                setTimeout(() => {
                    alert('üéâ Congratulations! You have found all evidence and successfully tracked Dr. Hassan through the Sahara! Case #2 SOLVED!');
                }, 500);
            }
        }
        
        // Helper function for difficulty colors
        function getDifficultyColor(difficulty) {
            switch(difficulty) {
                case 'Easy': return '#2ecc71';
                case 'Medium': return '#f39c12';
                case 'Hard': return '#e74c3c';
                case 'Very Hard': return '#8e44ad';
                default: return '#333';
            }
        }
        
        // Layer toggle functions with visual feedback
        function toggleLayer(layerName) {
            const button = event.target; // Get the button that was clicked
            
            if (saharaMap.hasLayer(layers[layerName])) {
                saharaMap.removeLayer(layers[layerName]);
                button.classList.remove('active');
            } else {
                saharaMap.addLayer(layers[layerName]);
                button.classList.add('active');
            }
        }
        
        // Investigation panel toggle
        function togglePanel() {
            const panel = document.getElementById('investigationPanel');
            panel.classList.toggle('open');
        }
        
        // Print function
        function printMap() {
            window.print();
        }
        
        // Initialize map with all layers
        function initializeMap() {
            addTradeRoutes();
            addStations();
            addEvidence();
            addCities();
            addIndigenous();
            addDesertification();
            
            // Add core layers by default (rivers, stations, evidence)
            saharaMap.addLayer(layers.rivers);
            saharaMap.addLayer(layers.stations);
            saharaMap.addLayer(layers.evidence);
            
            // Mark core layer buttons as active initially
            document.querySelectorAll('.detective-btn').forEach(btn => {
                const btnText = btn.textContent.trim();
                if (btnText.includes('Rivers') || btnText.includes('Stations') || btnText.includes('Evidence')) {
                    btn.classList.add('active');
                }
            });
            
            // Add scale
            L.control.scale().addTo(saharaMap);
            
            // Add coordinates display on click
            saharaMap.on('click', function(e) {
                console.log(`Clicked at: ${e.latlng.lat.toFixed(4)}, ${e.latlng.lng.toFixed(4)}`);
            });
        }
        
        // Initialize the map when page loads
        document.addEventListener('DOMContentLoaded', initializeMap);
    </script>
</body>
</html>
