<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Lesson Vocabulary Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .test-container { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .lesson-content { background-color: #f8f9fa; padding: 15px; border: 1px solid #dee2e6; border-radius: 4px; margin: 10px 0; }
        .vocabulary-item { margin: 5px 0; padding: 8px; background-color: #e9ecef; border: 1px solid #dee2e6; border-radius: 4px; }
        .term { font-weight: bold; color: #0056b3; }
        .definition { margin-top: 5px; color: #333; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .failure { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <h1>Real Lesson Vocabulary Extraction Test</h1>
    
    <div class="test-container">
        <h2>Test Lesson Content (Module 24, Lesson 1 Format)</h2>
        <div id="lesson-content" class="lesson-content">
            <h1>Lesson 1: Physical Geography</h1>
            <h2>Assessment</h2>
            <ol>
                <li><strong>Key Terms and Places</strong> Write a short definition for each term.
                    <ul>
                        <li>Niger River</li>
                        <li>inland delta</li>
                        <li>savanna</li>
                        <li>tropical rainforest</li>
                        <li>Congo River Basin</li>
                    </ul>
                </li>
            </ol>
        </div>
    </div>

    <div class="test-container">
        <h2>Alternative Format Test (Module 30 Format)</h2>
        <div id="lesson-content-2" class="lesson-content">
            <h1>Lesson 1: Japan and Korea Physical Geography</h1>
            <h2>Assessment</h2>
            <ol>
                <li><strong>Key Terms and Places</strong> Write a short definition for each term.
                    <ul>
                        <li>Fuji</li>
                        <li>Korean Peninsula</li>
                        <li>tsunamis</li>
                        <li>fishery</li>
                    </ul>
                </li>
            </ol>
        </div>
    </div>
    
    <div class="test-container">
        <h2>Test Results</h2>
        <div id="testResults"></div>
    </div>
    
    <div class="test-container">
        <h2>Extracted Vocabulary</h2>
        <div id="vocabularyResults"></div>
    </div>

    <script>
        // Vocabulary definitions database
        const vocabDB = {
            'niger river': 'The principal river of West Africa, flowing from Guinea through Mali, Niger, and Nigeria to the Gulf of Guinea',
            'inland delta': 'A triangular area where the Niger River spreads out into many channels, creating wetlands in Mali',
            'savanna': 'A grassland ecosystem with scattered trees, typical of tropical regions with wet and dry seasons',
            'tropical rainforest': 'A dense forest found in tropical areas with high rainfall and constant warm temperatures',
            'congo river basin': 'The drainage basin of the Congo River in Central Africa, containing vast tropical rainforests',
            'fuji': 'Mount Fuji, Japans highest mountain and an active volcano, considered sacred in Japanese culture',
            'korean peninsula': 'A peninsula in East Asia that extends south from China, divided into North and South Korea',
            'tsunamis': 'Large ocean waves caused by underwater earthquakes, volcanic eruptions, or landslides',
            'fishery': 'An area of water where fish are caught commercially, or a business enterprise involved in fishing'
        };

        function parseVocabularyTerm(termText, extractedTerms) {
            if (!termText || termText === '') return;
            
            const term = termText.trim();
            if (term && !extractedTerms.some(t => t.term.toLowerCase() === term.toLowerCase())) {
                extractedTerms.push({ 
                    term, 
                    definition: generateDefinitionForTerm(term)
                });
            }
        }

        function generateDefinitionForTerm(term) {
            const termLower = term.toLowerCase();
            
            if (vocabDB[termLower]) {
                return vocabDB[termLower];
            }
            
            for (const [key, definition] of Object.entries(vocabDB)) {
                if (termLower.includes(key) || key.includes(termLower)) {
                    return definition;
                }
            }
            
            if (termLower.includes('mountain') || termLower.includes('mount')) {
                return 'A large natural elevation of Earth surface rising abruptly from the surrounding level';
            }
            if (termLower.includes('river')) {
                return 'A large natural stream of water flowing in a channel to the sea, a lake, or another river';
            }
            if (termLower.includes('delta')) {
                return 'A triangular area of sediment deposited at the mouth of a river';
            }
            if (termLower.includes('basin')) {
                return 'A large area of land drained by a river and its tributaries';
            }
            if (termLower.includes('peninsula')) {
                return 'A piece of land almost surrounded by water or projecting out into a body of water';
            }
            
            return 'Geographic term: ' + term;
        }

        function extractVocabularyFromContent(contentElement) {
            if (!contentElement) return [];
            
            const extractedTerms = [];
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = contentElement.innerHTML;
            
            // Look for elements containing "Key Terms"
            const allElements = tempDiv.querySelectorAll('*');
            
            for (const element of allElements) {
                const elementText = element.textContent.toLowerCase();
                if (elementText.includes('key terms') && element.nextElementSibling) {
                    
                    let nextElement = element.nextElementSibling;
                    
                    // Look for lists in subsequent elements
                    while (nextElement && !nextElement.matches('h1, h2, h3, h4, h5, h6')) {
                        if (nextElement.tagName === 'UL' || nextElement.tagName === 'OL') {
                            const listItems = nextElement.querySelectorAll('li');
                            for (const item of listItems) {
                                const itemText = item.textContent.trim();
                                if (itemText && itemText !== 'Write a short definition for each term.') {
                                    parseVocabularyTerm(itemText, extractedTerms);
                                }
                            }
                        }
                        nextElement = nextElement.nextElementSibling;
                    }
                }
            }
            
            return extractedTerms;
        }

        // Run tests
        function runTests() {
            const testResults = document.getElementById('testResults');
            const vocabularyResults = document.getElementById('vocabularyResults');
            
            let totalTests = 0;
            let passedTests = 0;
            let allVocabulary = [];
            
            const testContents = [
                { element: document.getElementById('lesson-content'), name: 'Module 24 Format' },
                { element: document.getElementById('lesson-content-2'), name: 'Module 30 Format' }
            ];
            
            testContents.forEach((test, index) => {
                totalTests++;
                
                console.log('Testing: ' + test.name);
                const vocabulary = extractVocabularyFromContent(test.element);
                
                if (vocabulary.length > 0) {
                    passedTests++;
                    testResults.innerHTML += '<div class="test-result success">✓ Test ' + (index + 1) + ': ' + test.name + ' - Extracted ' + vocabulary.length + ' terms</div>';
                } else {
                    testResults.innerHTML += '<div class="test-result failure">✗ Test ' + (index + 1) + ': ' + test.name + ' - No vocabulary extracted</div>';
                }
                
                allVocabulary = allVocabulary.concat(vocabulary.map(v => ({...v, source: test.name})));
            });
            
            testResults.innerHTML += '<div style="background-color: #e1f5fe; padding: 10px; border-radius: 4px; margin: 10px 0;"><strong>Test Summary:</strong> ' + passedTests + '/' + totalTests + ' tests passed</div>';
            
            allVocabulary.forEach(vocab => {
                vocabularyResults.innerHTML += '<div class="vocabulary-item"><div class="term">' + vocab.term + '</div><div class="definition">' + vocab.definition + '</div><small style="color: #666;">Source: ' + vocab.source + '</small></div>';
            });
            
            console.log('All extracted vocabulary:', allVocabulary);
        }
        
        window.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>
